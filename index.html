
<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>中国药物研发统计编程行业 AI 应用演变与展望调研（2023-2025）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <meta name="color-scheme" content="light" />
  <style>
    /* 基础样式优化 */
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    /* 主容器样式 */
    .main-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      margin: 2rem auto;
    }
    
    /* 卡片样式 */
    .section-card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s ease;
      overflow: hidden;
    }
    
    .section-card:hover {
      transform: translateY(-2px);
    }
    
    /* 标题样式 */
    .section-title {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      padding: 1.5rem 2rem;
      font-size: 1.25rem;
      font-weight: 600;
      color: #1e293b;
      margin: 0;
    }
    
    /* 表单控件 */
    input[type="radio"], input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #4f46e5;
    }
    
    input[type="text"], input[type="email"], textarea, select {
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 0.75rem;
      transition: all 0.2s ease;
    }
    
    input[type="text"]:focus, input[type="email"]:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #4f46e5;
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }
    
    /* 标签样式 */
    label {
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 8px;
      transition: background-color 0.2s ease;
    }
    
    label:hover {
      background-color: #f8fafc;
    }
    
    /* 矩阵表格 */
    .matrix {
      border-collapse: collapse;
      border-spacing: 0;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    
    .matrix th, .matrix td {
      border: 1px solid #e2e8f0;
      padding: 12px;
      background: white;
    }
    
    .matrix th {
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      font-weight: 600;
      color: #334155;
    }
    

    
    .matrix td { text-align: center; }
    .matrix th:first-child, .matrix td:first-child { text-align: left !important; }
    
    .matrix tr:hover td {
      background-color: #f8fafc;
    }
    
    .matrix td.disabled {
      background-color: #f3f4f6;
      opacity: 0.6;
    }
    
    /* 按钮样式 */
    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.2s ease;
      border: none;
      cursor: pointer;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4);
    }
    
    /* 其他样式 */
    .hidden-important { display: none !important; }
    .indent-row { padding-left: 2rem !important; }
    .required-star { color: #ef4444; font-weight: bold; }
    
    /* 禁用状态样式 */
    .disabled-input {
      opacity: 0.5;
      pointer-events: none;
      background-color: #f3f4f6;
    }
    
    /* 拖拽排序样式 */
    .sortable-item {
      transition: all 0.2s ease;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    .sortable-item:hover, .sortable-item:active {
      background-color: #f3f4f6;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .sortable-item.dragging {
      opacity: 0.5;
      transform: rotate(2deg);
      z-index: 1000;
    }
    
    /* 移动端优化 */
    @media (max-width: 768px) {
      .sortable-item {
        padding: 1rem;
        margin-bottom: 0.5rem;
      }
      .drag-handle {
        font-size: 1.2rem;
      }
    }
    
    /* 报告样式 */
    .chart-bar {
      transition: all 0.5s ease;
    }
    
    .chart-bar:hover {
      opacity: 0.8;
    }
    
    #surveyReport {
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .animate-fadeIn {
      animation: fadeIn 0.5s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* 响应式 */
    @media (max-width: 768px) {
      .main-container {
        margin: 1rem;
        border-radius: 16px;
      }
      
      .matrix {
        font-size: 0.65rem;
        width: 100%;
        table-layout: fixed;
      }
      
      .matrix th, .matrix td {
        padding: 4px 1px;
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
      }
      
      .matrix th:first-child, .matrix td:first-child {
        width: 35%;
      }
      
      .matrix th:not(:first-child), .matrix td:not(:first-child) {
        width: 13%;
      }
      
      #surveyReport {
        max-height: 90vh;
      }
      
      #surveyReport .grid {
        grid-template-columns: 1fr;
      }
      
      footer {
        border-radius: 0 0 16px 16px;
      }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="max-w-5xl main-container">
    <header class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-8 text-center">
      <h1 class="text-3xl font-bold mb-4">中国药物研发统计编程行业 AI 应用演变与展望调研（2023-2025）</h1>


    </header>
    
    <div class="p-6">

    <section class="mb-6">
      <div class="bg-white p-6 rounded-lg border shadow-sm">
        <h3 class="font-semibold text-lg mb-4">填写说明</h3>
        <div class="text-sm text-gray-700 space-y-4">
          <div class="flex items-start gap-3">
            <span class="text-lg">⏱️</span>
            <div>
              <strong>预计填写时间：5-10分钟</strong>
            </div>
          </div>
          
          <div class="flex items-start gap-3">
            <span class="text-lg">📢</span>
            <div>
              <strong>调研结果将于2025年11月7日在 PHUSE SDE 活动中线下和线上同时公布</strong>
            </div>
          </div>
          
          <div class="flex items-start gap-3">
            <span class="text-lg">🔒</span>
            <div>
              <strong>完全匿名调研</strong><br>
              本问卷不收集任何个人身份信息或公司信息，所有数据仅用于行业趋势分析。
            </div>
          </div>
          
          <div class="flex items-start gap-3">
            <span class="text-lg">🤖</span>
            <div>
              <strong>AI 定义</strong><br>
              本问卷中的"AI"特指生成式 AI/大语言模型及其衍生工具（如ChatGPT、Claude、Copilot、代码生成工具等），不包含传统宏/脚本工具。
            </div>
          </div>
          
          <div class="flex items-start gap-3">
            <span class="text-lg">📅</span>
            <div>
              <strong>年份口径与背景</strong><br>
              • 2023年（2023.01–12）：生成式AI"元年"，ChatGPT等工具开始普及<br>
              • 2024年（2024.01–12）：AI技术"高速发展"期，各类工具百花齐放<br>
              • 2025年（2025.01–填写当月）：行业"逐步落地"阶段，实际项目应用增多
            </div>
          </div>
          
          <div class="flex items-start gap-3">
            <span class="text-lg">🎯</span>
            <div>
              <strong>调研目的</strong><br>
              追踪中国药物研发统计编程行业在AI应用方面的演进轨迹，为行业发展提供数据支撑和趋势洞察。
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 用户标签显示区域 -->
    <section id="userTagsSection" class="mb-6 hidden">
      <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
        <h3 class="font-semibold text-lg mb-3 text-blue-800">🏷️ 您的用户标签</h3>
        <div id="userTagsDisplay" class="flex flex-wrap gap-2">
          <!-- 标签将通过JavaScript动态添加 -->
        </div>
        <p class="text-sm text-blue-600 mt-2">基于您的回答自动生成的标签，用于个性化问卷体验</p>
      </div>
    </section>

    <form id="surveyForm" class="space-y-10">
      <!-- A. 筛选与分支 S -->
      <div id="blockA" class="section-card">
        <h2 class="section-title">👤 基本信息</h2>
        <div class="p-6 space-y-6">

        <!-- S1 -->
        <div>
          <label class="font-bold">您目前的主要工作地点在中国大陆吗？ <span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="radio" name="S1" value="A"> <span>是</span></label>
            <label class="flex items-center gap-2"><input type="radio" name="S1" value="B"> <span>否（将结束问卷）</span></label>
          </div>
          <p id="endMsgS1" class="mt-2 text-sm text-red-600 hidden">您选择了"否"，问卷将在此结束。非常感谢您的时间！</p>
        </div>

        <!-- S2 单选 -->
        <div>
          <label class="font-bold">您所在的组织类型（单选）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="radio" name="S2" value="A"> 跨国药企（MNC）在华机构</label>
            <label class="flex items-center gap-2"><input type="radio" name="S2" value="B"> 本土药企（Local）</label>
            <label class="flex items-center gap-2"><input type="radio" name="S2" value="C"> CRO/服务外包公司</label>
            <label class="flex items-center gap-2"><input type="radio" name="S2" value="D"> 其他医药相关机构</label>
            <label class="flex items-center gap-2"><input type="radio" name="S2" value="E"> 不方便透露</label>
          </div>
        </div>

        <!-- S3 多选 -->
        <div>
          <label class="font-bold">您近一年在统计编程相关的主要工作内容（多选）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" name="S3" value="A"> 生成/QC SDTM</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="S3" value="B"> 生成/QC ADaM</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="S3" value="C"> 生成/QC TLF（表/图/列表）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="S3" value="D"> 支持递交相关工作（Define.xml/ADRG/数据集说明文档等）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="S3" value="E"> 工具与宏/包开发与维护（SAS/R/Python）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="S3" value="F"> 项目管理（Project Manager/Portfolio Lead/协调交付）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="S3" value="G"> 带人经理/团队管理</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="S3" value="H"> <span>其他：</span> <input type="text" name="S3-OTHER" class="border rounded px-2 py-1 text-sm ml-2 flex-1" placeholder="请填写" disabled></label>
          </div>
        </div>

        <!-- S5 -->
        <div>
          <label class="font-bold">您在 2025 年工作中使用 AI 的频率（单选）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="radio" name="S5" value="A"> 从不</label>
            <label class="flex items-center gap-2"><input type="radio" name="S5" value="B"> 很少（每季度或更少）</label>
            <label class="flex items-center gap-2"><input type="radio" name="S5" value="C"> 偶尔（每月）</label>
            <label class="flex items-center gap-2"><input type="radio" name="S5" value="D"> 经常（每周）</label>
            <label class="flex items-center gap-2"><input type="radio" name="S5" value="E"> 频繁（几乎每天）</label>
          </div>
        </div>

        <!-- S6 多选，每行一个 -->
        <div id="S6Question" class="hidden">
          <label class="font-bold">您在工作中用 AI 做过哪些类型的任务（多选）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" name="S6" value="A"> 代码片段/脚本建议（SAS/R/Python）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="S6" value="B"> 数据清洗/转换/映射（如 SDTM/ADaM 辅助）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="S6" value="C"> 生成统计分析思路/表图（TLF）草案</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="S6" value="D"> 文档生成/润色（邮件、SAP、程序注释、审计说明）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="S6" value="E"> 自动化工作流/工具集成（API、LangChain、自建 Agent）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="S6" value="F"> 内部知识库/RAG（如 SOP/模板/最佳实践检索）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="S6" value="G"> 模型微调/本地化部署/私有化</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="S6" value="H"> 风险与合规评估/代码校验辅助</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="S6" value="I"> <span>其他：</span> <input type="text" name="S6-OTHER" class="border rounded px-2 py-1 text-sm ml-2 flex-1" placeholder="请填写" disabled></label>
          </div>
        </div>

        <!-- Next按钮 -->
        <div class="mt-6 text-center">
          <button type="button" id="nextToAISection" class="btn btn-primary">下一步：AI使用情况 →</button>
        </div>
        </div>
      </div>

      <!-- C. AI 使用情况 -->
      <div id="blockC" class="section-card hidden">
        <h2 class="section-title">🤖 AI 使用情况（2023–2025 年对比）</h2>
        <div class="p-6 space-y-6">

        <!-- C1 矩阵单选 -->
        <div data-tags="深度用户">
          <label class="font-bold">您在工作中使用 AI 的频率（矩阵单选）<span class="required-star">*</span></label>
          <table class="matrix w-full mt-2 text-sm">
            <thead>
              <tr class="bg-gray-50">
                <th class="text-left">年份</th>
                <th>从不</th>
                <th>很少（季度）</th>
                <th>偶尔（月）</th>
                <th>经常（周）</th>
                <th>频繁（几乎每天）</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="font-medium">2023 年</td>
                <td><input type="radio" name="C1_2023" value="从不"></td>
                <td><input type="radio" name="C1_2023" value="很少（季度）"></td>
                <td><input type="radio" name="C1_2023" value="偶尔（月）"></td>
                <td><input type="radio" name="C1_2023" value="经常（周）"></td>
                <td><input type="radio" name="C1_2023" value="频繁（几乎每天）"></td>
              </tr>
              <tr>
                <td class="font-medium">2024 年</td>
                <td><input type="radio" name="C1_2024" value="从不"></td>
                <td><input type="radio" name="C1_2024" value="很少（季度）"></td>
                <td><input type="radio" name="C1_2024" value="偶尔（月）"></td>
                <td><input type="radio" name="C1_2024" value="经常（周）"></td>
                <td><input type="radio" name="C1_2024" value="频繁（几乎每天）"></td>
              </tr>
              <tr>
                <td class="font-medium">2025 年（至今）</td>
                <td><input type="radio" name="C1_2025" value="从不"></td>
                <td><input type="radio" name="C1_2025" value="很少（季度）"></td>
                <td><input type="radio" name="C1_2025" value="偶尔（月）"></td>
                <td><input type="radio" name="C1_2025" value="经常（周）"></td>
                <td><input type="radio" name="C1_2025" value="频繁（几乎每天）"></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- C2 矩阵多选 -->
        <div data-tags="深度用户">
          <label class="font-bold">您在各年份主要使用 AI 的场景（矩阵多选）<span class="required-star">*</span></label>
          <table class="matrix w-full mt-2 text-sm">
            <thead>
              <tr class="bg-gray-50">
                <th class="text-left">场景</th>
                <th>2023 年</th>
                <th>2024 年</th>
                <th>2025 年</th>
              </tr>
            </thead>
            <tbody id="C2TableBody">
              <tr>
                <td class="font-medium">代码生成/补全</td>
                <td><input type="checkbox" name="C2_代码生成/补全_2023"></td>
                <td><input type="checkbox" name="C2_代码生成/补全_2024"></td>
                <td><input type="checkbox" name="C2_代码生成/补全_2025"></td>
              </tr>
              <tr>
                <td class="font-medium">数据清洗/映射</td>
                <td><input type="checkbox" name="C2_数据清洗/映射_2023"></td>
                <td><input type="checkbox" name="C2_数据清洗/映射_2024"></td>
                <td><input type="checkbox" name="C2_数据清洗/映射_2025"></td>
              </tr>
              <tr>
                <td class="font-medium">统计分析/方法建议</td>
                <td><input type="checkbox" name="C2_统计分析/方法建议_2023"></td>
                <td><input type="checkbox" name="C2_统计分析/方法建议_2024"></td>
                <td><input type="checkbox" name="C2_统计分析/方法建议_2025"></td>
              </tr>
              <tr>
                <td class="font-medium">TLF 生成辅助</td>
                <td><input type="checkbox" name="C2_TLF生成辅助_2023"></td>
                <td><input type="checkbox" name="C2_TLF生成辅助_2024"></td>
                <td><input type="checkbox" name="C2_TLF生成辅助_2025"></td>
              </tr>
              <tr>
                <td class="font-medium">文档撰写/审阅</td>
                <td><input type="checkbox" name="C2_文档撰写/审阅_2023"></td>
                <td><input type="checkbox" name="C2_文档撰写/审阅_2024"></td>
                <td><input type="checkbox" name="C2_文档撰写/审阅_2025"></td>
              </tr>
              <tr>
                <td class="font-medium">知识库检索/RAG</td>
                <td><input type="checkbox" name="C2_知识库检索/RAG_2023"></td>
                <td><input type="checkbox" name="C2_知识库检索/RAG_2024"></td>
                <td><input type="checkbox" name="C2_知识库检索/RAG_2025"></td>
              </tr>
              <tr>
                <td class="font-medium">自动化工作流</td>
                <td><input type="checkbox" name="C2_自动化工作流_2023"></td>
                <td><input type="checkbox" name="C2_自动化工作流_2024"></td>
                <td><input type="checkbox" name="C2_自动化工作流_2025"></td>
              </tr>
              <tr>
                <td class="font-medium">合规/风险评估</td>
                <td><input type="checkbox" name="C2_合规/风险评估_2023"></td>
                <td><input type="checkbox" name="C2_合规/风险评估_2024"></td>
                <td><input type="checkbox" name="C2_合规/风险评估_2025"></td>
              </tr>
              <tr>
                <td class="font-medium">未使用AI</td>
                <td><input type="checkbox" name="C2_未使用AI_2023"></td>
                <td><input type="checkbox" name="C2_未使用AI_2024"></td>
                <td><input type="checkbox" name="C2_未使用AI_2025"></td>
              </tr>
              <tr>
                <td class="font-medium">其他</td>
                <td><input type="checkbox" name="C2_其他_2023"></td>
                <td><input type="checkbox" name="C2_其他_2024"></td>
                <td><input type="checkbox" name="C2_其他_2025"></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- C3 矩阵单选 -->
        <div data-tags="深度用户">
          <label class="font-bold">您自评在各年份因 AI 带来的效率提升幅度（矩阵单选）<span class="required-star">*</span></label>
          <table class="matrix w-full mt-2 text-sm">
            <thead>
              <tr class="bg-gray-50">
                <th class="text-left">年份</th>
                <th>&lt;10%（含0%）</th>
                <th>10–30%</th>
                <th>30–50%</th>
                <th>50–100%</th>
                <th>&gt;100%</th>
                <th>不好说/未评估</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="font-medium">2023 年</td>
                <td><input type="radio" name="C3_2023" value="<10%（含0%）"></td>
                <td><input type="radio" name="C3_2023" value="10–30%"></td>
                <td><input type="radio" name="C3_2023" value="30–50%"></td>
                <td><input type="radio" name="C3_2023" value="50–100%"></td>
                <td><input type="radio" name="C3_2023" value=">100%"></td>
                <td><input type="radio" name="C3_2023" value="不好说/未评估"></td>
              </tr>
              <tr>
                <td class="font-medium">2024 年</td>
                <td><input type="radio" name="C3_2024" value="<10%（含0%）"></td>
                <td><input type="radio" name="C3_2024" value="10–30%"></td>
                <td><input type="radio" name="C3_2024" value="30–50%"></td>
                <td><input type="radio" name="C3_2024" value="50–100%"></td>
                <td><input type="radio" name="C3_2024" value=">100%"></td>
                <td><input type="radio" name="C3_2024" value="不好说/未评估"></td>
              </tr>
              <tr>
                <td class="font-medium">2025 年</td>
                <td><input type="radio" name="C3_2025" value="<10%（含0%）"></td>
                <td><input type="radio" name="C3_2025" value="10–30%"></td>
                <td><input type="radio" name="C3_2025" value="30–50%"></td>
                <td><input type="radio" name="C3_2025" value="50–100%"></td>
                <td><input type="radio" name="C3_2025" value=">100%"></td>
                <td><input type="radio" name="C3_2025" value="不好说/未评估"></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- C4 矩阵单选 -->
        <div data-tags="深度用户">
          <label class="font-bold">您的团队/组织是否有 AI 使用政策（矩阵单选）<span class="required-star">*</span></label>
          <table class="matrix w-full mt-2 text-sm">
            <thead>
              <tr class="bg-gray-50">
                <th class="text-left">年份</th>
                <th>无政策</th>
                <th>有非正式指南</th>
                <th>有正式政策但不强制</th>
                <th>有正式且强制政策</th>
                <th>不清楚</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="font-medium">2023 年</td>
                <td><input type="radio" name="C4_2023" value="无政策"></td>
                <td><input type="radio" name="C4_2023" value="有非正式指南"></td>
                <td><input type="radio" name="C4_2023" value="有正式政策但不强制"></td>
                <td><input type="radio" name="C4_2023" value="有正式且强制政策"></td>
                <td><input type="radio" name="C4_2023" value="不清楚"></td>
              </tr>
              <tr>
                <td class="font-medium">2024 年</td>
                <td><input type="radio" name="C4_2024" value="无政策"></td>
                <td><input type="radio" name="C4_2024" value="有非正式指南"></td>
                <td><input type="radio" name="C4_2024" value="有正式政策但不强制"></td>
                <td><input type="radio" name="C4_2024" value="有正式且强制政策"></td>
                <td><input type="radio" name="C4_2024" value="不清楚"></td>
              </tr>
              <tr>
                <td class="font-medium">2025 年</td>
                <td><input type="radio" name="C4_2025" value="无政策"></td>
                <td><input type="radio" name="C4_2025" value="有非正式指南"></td>
                <td><input type="radio" name="C4_2025" value="有正式政策但不强制"></td>
                <td><input type="radio" name="C4_2025" value="有正式且强制政策"></td>
                <td><input type="radio" name="C4_2025" value="不清楚"></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- C5 多选，每行一个 -->
        <div data-tags="初级用户,深度用户">
          <label class="font-bold">您在 2025 年常用的 AI/模型或平台（多选）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" name="C5" value="A"> ChatGPT 系列</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C5" value="B"> Claude</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C5" value="C"> Gemini</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C5" value="D"> DeepSeek</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C5" value="E"> Copilot（SAS/R/Python/VS Code 等）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C5" value="F"> 国产大模型（阿里/百度/字节/华为等）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C5" value="G"> 私有化/本地 LLM</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C5" value="H"> 公司自研工具</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C5" value="I"> 不了解/未关注</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C5" value="J"> 不方便透露</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C5" value="K"> <span>其他：</span><input type="text" name="C5-OTHER" class="border rounded px-2 py-1 text-sm ml-2 flex-1" placeholder="请填写" disabled></label>
          </div>
        </div>

        <!-- C6 单选，每行一个 -->
        <div data-tags="初级用户,深度用户">
          <label class="font-bold">您在 2025 年用于处理含敏感数据的做法（单选）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="radio" name="C6" value="A"> 从不在 AI 工具中输入敏感数据</label>
            <label class="flex items-center gap-2"><input type="radio" name="C6" value="B"> 仅在公司批准的安全环境中使用（如私有化、脱敏）</label>
            <label class="flex items-center gap-2"><input type="radio" name="C6" value="C"> 公司 AI 工具会自动屏蔽/脱敏敏感信息，我不作额外处理直接上传</label>
            <label class="flex items-center gap-2"><input type="radio" name="C6" value="D"> 在公开云工具中谨慎使用（删除标识/片段化）</label>
            <label class="flex items-center gap-2"><input type="radio" name="C6" value="E"> 不清楚/未关注</label>
          </div>
        </div>

        <!-- C7 多选题 -->
        <div data-tags="初级用户,深度用户">
          <label class="font-bold">您主要通过哪些渠道学习 AI 相关知识和技能（多选）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" name="C7" value="A"> 公司内部培训</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C7" value="B"> 在线课程（如 Coursera、Udemy 等）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C7" value="C"> 行业会议/研讨会（如 PHUSE、其他专业会议）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C7" value="D"> 网络资源（博客、技术文档、GitHub 等）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C7" value="E"> 同事/朋友分享</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C7" value="F"> 社交媒体（微信公众号、LinkedIn、Twitter 等）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C7" value="G"> 专业书籍/论文</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C7" value="H"> 自学实践（直接使用 AI 工具摸索）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C7" value="I"> 没有主动学习</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="C7" value="J"> <span>其他：</span><input type="text" name="C7-OTHER" class="border rounded px-2 py-1 text-sm ml-2 flex-1" placeholder="请填写" disabled></label>
          </div>
        </div>

        <!-- CD1 多选题 -->
        <div data-tags="深度用户">
          <label class="font-bold">您在使用AI进行统计编程时，主要采用哪些prompt策略？（可多选）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" name="CD1" value="A"> 直接描述需求，让AI生成完整代码</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD1" value="B"> 提供代码框架，让AI填充具体实现</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD1" value="C"> 分步骤引导，逐步构建复杂逻辑</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD1" value="D"> 提供示例代码，要求AI模仿风格</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD1" value="E"> 角色扮演（如"你是SAS专家"）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD1" value="F"> 提供上下文（数据结构、业务背景）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD1" value="G"> 要求解释代码逻辑与思路</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD1" value="H"> <span>其他策略：</span><input type="text" name="CD1-OTHER" class="border rounded px-2 py-1 text-sm ml-2 flex-1" placeholder="请填写" disabled></label>
          </div>
        </div>

        
        <!-- CD2 单选题 -->
        <div data-tags="深度用户">
          <label class="font-bold">您认为目前AI在以下哪个统计编程任务上表现最佳？（单选）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="radio" name="CD2" value="A"> 基础数据操作（筛选、排序、合并）</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD2" value="B"> 标准统计分析（描述性统计、t检验等）</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD2" value="C"> 复杂数据清洗与转换逻辑</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD2" value="D"> 图表制作与美化</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD2" value="E"> 代码注释与文档生成</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD2" value="F"> 错误调试与代码优化</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD2" value="G"> 都表现一般</label>
          </div>
        </div>

        <!-- CD3 多选题 -->
        <div data-tags="深度用户">
          <label class="font-bold">您在深度使用AI的过程中，遇到过哪些典型问题？（可多选）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" name="CD3" value="A"> 生成的代码语法错误或无法运行</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD3" value="B"> 逻辑错误，结果看似合理但实际有误</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD3" value="C"> 不理解特定领域术语（如CDISC标准）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD3" value="D"> 代码效率低下，运行速度慢</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD3" value="E"> 风格不一致，难以维护</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD3" value="F"> 过度复杂化简单问题</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD3" value="G"> 无法处理边界情况或异常数据</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD3" value="H"> 版本间不一致（同样问题不同回答）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD3" value="I"> <span>其他问题：</span><input type="text" name="CD3-OTHER" class="border rounded px-2 py-1 text-sm ml-2 flex-1" placeholder="请填写" disabled></label>
          </div>
        </div>

        <!-- CD4 单选题 -->
        <div data-tags="深度用户">
          <label class="font-bold">您通常如何验证AI生成代码的正确性？（单选最主要的方法）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="radio" name="CD4" value="A"> 逐行检查代码逻辑</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD4" value="B"> 用已知结果的测试数据验证</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD4" value="C"> 与传统方法的结果对比</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD4" value="D"> 同事进行代码审查</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD4" value="E"> 分步运行，检查中间结果</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD4" value="F"> 直接使用，出问题再修正</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD4" value="G"> 多个AI工具交叉验证</label>
          </div>
        </div>

        <!-- CD5 矩阵单选题 -->
        <div data-tags="深度用户">
          <label class="font-bold">您对AI在不同复杂度任务上的信任程度<span class="required-star">*</span></label>
          <table class="matrix w-full mt-2 text-sm">
            <thead>
              <tr class="bg-gray-50">
                <th class="text-left">任务复杂度</th>
                <th>完全信任</th>
                <th>基本信任</th>
                <th>谨慎验证</th>
                <th>严格校验</th>
                <th>不敢使用</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="font-medium">简单重复任务（如数据导入）</td>
                <td><input type="radio" name="CD5_simple" value="完全信任"></td>
                <td><input type="radio" name="CD5_simple" value="基本信任"></td>
                <td><input type="radio" name="CD5_simple" value="谨慎验证"></td>
                <td><input type="radio" name="CD5_simple" value="严格校验"></td>
                <td><input type="radio" name="CD5_simple" value="不敢使用"></td>
              </tr>
              <tr>
                <td class="font-medium">中等复杂度（如多表关联分析）</td>
                <td><input type="radio" name="CD5_medium" value="完全信任"></td>
                <td><input type="radio" name="CD5_medium" value="基本信任"></td>
                <td><input type="radio" name="CD5_medium" value="谨慎验证"></td>
                <td><input type="radio" name="CD5_medium" value="严格校验"></td>
                <td><input type="radio" name="CD5_medium" value="不敢使用"></td>
              </tr>
              <tr>
                <td class="font-medium">高复杂度（如临床终点分析）</td>
                <td><input type="radio" name="CD5_complex" value="完全信任"></td>
                <td><input type="radio" name="CD5_complex" value="基本信任"></td>
                <td><input type="radio" name="CD5_complex" value="谨慎验证"></td>
                <td><input type="radio" name="CD5_complex" value="严格校验"></td>
                <td><input type="radio" name="CD5_complex" value="不敢使用"></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- CD6 开放题 -->
        <div data-tags="深度用户">
          <label class="font-bold">请分享一个AI显著帮助您解决的具体技术难题：</label>
          <textarea name="CD6" rows="3" class="w-full border rounded px-2 py-1 text-sm mt-2" placeholder="如：AI帮我解决了某个复杂的数据清洗逻辑，原本需要...，AI建议...，最终节省了...时间"></textarea>
        </div>

        <!-- CD7 多选题 -->
        <div data-tags="深度用户,决策者">
          <label class="font-bold">您希望AI工具在哪些方面得到改进？（可多选，最多5项）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" name="CD7" value="A"> 更好的领域知识（CDISC/ICH等标准）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD7" value="B"> 更强的代码调试与错误定位能力</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD7" value="C"> 更好的代码风格一致性</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD7" value="D"> 支持更复杂的多步骤任务</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD7" value="E"> 更准确的性能优化建议</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD7" value="F"> 更好的文档与注释生成</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD7" value="G"> 支持团队协作与代码标准化</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD7" value="H"> 更强的数据安全与隐私保护</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD7" value="I"> 更便宜的使用成本</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD7" value="J"> 更快的响应速度</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="CD7" value="K"> <span>其他改进：</span><input type="text" name="CD7-OTHER" class="border rounded px-2 py-1 text-sm ml-2 flex-1" placeholder="请填写" disabled></label>
          </div>
        </div>

        <!-- CD8 单选题 -->
        <div data-tags="深度用户,决策者">
          <label class="font-bold">如果AI持续改进，您预计多久后能在关键项目中放心使用AI生成的核心代码？<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="radio" name="CD8" value="A"> 现在就可以（已经在用）</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD8" value="B"> 6个月内</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD8" value="C"> 1-2年内</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD8" value="D"> 3-5年内</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD8" value="E"> 5年以上</label>
            <label class="flex items-center gap-2"><input type="radio" name="CD8" value="F"> 永远不会完全放心</label>
          </div>
        </div>

        <!-- CD9 开放题 -->
        <div data-tags="深度用户">
          <label class="font-bold">作为AI深度用户，您对同行有什么使用建议？</label>
          <textarea name="CD9" rows="3" class="w-full border rounded px-2 py-1 text-sm mt-2" placeholder="如：推荐从...开始，注意...，避免..."></textarea>
        </div>


        <!-- Next按钮 -->
        <div class="mt-6 text-center">
          <button type="button" id="nextToAttitudeSection" class="btn btn-primary">下一步：AI态度 →</button>
        </div>
        </div>
      </div>

      <!-- D. 态度 -->
      <div id="blockD" class="section-card hidden">
        <h2 class="section-title">💭 您对 AI 的态度（2023–2025 年对比）</h2>
        <div class="p-6 space-y-6">

        <div>
          <label class="font-bold">您对以下陈述在各年份的看法（矩阵单选）<span class="required-star">*</span></label>
          <table class="matrix w-full mt-2 text-sm">
            <thead>
              <tr class="bg-gray-50">
                <th class="text-left">陈述/年份</th>
                <th>非常不同意</th>
                <th>不同意</th>
                <th>中立</th>
                <th>同意</th>
                <th>非常同意</th>
              </tr>
            </thead>
            <tbody>
              <!-- AI 提升统计编程效率 -->
              <tr><td colspan="6" class="bg-gray-50 font-semibold">AI 提升统计编程效率</td></tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2023年</td>
                <td><input type="radio" name="D1_2023年_1" value="非常不同意"></td>
                <td><input type="radio" name="D1_2023年_1" value="不同意"></td>
                <td><input type="radio" name="D1_2023年_1" value="中立"></td>
                <td><input type="radio" name="D1_2023年_1" value="同意"></td>
                <td><input type="radio" name="D1_2023年_1" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2024年</td>
                <td><input type="radio" name="D1_2024年_1" value="非常不同意"></td>
                <td><input type="radio" name="D1_2024年_1" value="不同意"></td>
                <td><input type="radio" name="D1_2024年_1" value="中立"></td>
                <td><input type="radio" name="D1_2024年_1" value="同意"></td>
                <td><input type="radio" name="D1_2024年_1" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2025年</td>
                <td><input type="radio" name="D1_2025年_1" value="非常不同意"></td>
                <td><input type="radio" name="D1_2025年_1" value="不同意"></td>
                <td><input type="radio" name="D1_2025年_1" value="中立"></td>
                <td><input type="radio" name="D1_2025年_1" value="同意"></td>
                <td><input type="radio" name="D1_2025年_1" value="非常同意"></td>
              </tr>

              <!-- AI 有助于减少低级错误 -->
              <tr><td colspan="6" class="bg-gray-50 font-semibold">AI 有助于减少低级错误</td></tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2023年</td>
                <td><input type="radio" name="D1_2023年_2" value="非常不同意"></td>
                <td><input type="radio" name="D1_2023年_2" value="不同意"></td>
                <td><input type="radio" name="D1_2023年_2" value="中立"></td>
                <td><input type="radio" name="D1_2023年_2" value="同意"></td>
                <td><input type="radio" name="D1_2023年_2" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2024年</td>
                <td><input type="radio" name="D1_2024年_2" value="非常不同意"></td>
                <td><input type="radio" name="D1_2024年_2" value="不同意"></td>
                <td><input type="radio" name="D1_2024年_2" value="中立"></td>
                <td><input type="radio" name="D1_2024年_2" value="同意"></td>
                <td><input type="radio" name="D1_2024年_2" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2025年</td>
                <td><input type="radio" name="D1_2025年_2" value="非常不同意"></td>
                <td><input type="radio" name="D1_2025年_2" value="不同意"></td>
                <td><input type="radio" name="D1_2025年_2" value="中立"></td>
                <td><input type="radio" name="D1_2025年_2" value="同意"></td>
                <td><input type="radio" name="D1_2025年_2" value="非常同意"></td>
              </tr>

              <!-- AI 增加合规/审计风险 -->
              <tr><td colspan="6" class="bg-gray-50 font-semibold">AI 增加合规/审计风险</td></tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2023年</td>
                <td><input type="radio" name="D1_2023年_3" value="非常不同意"></td>
                <td><input type="radio" name="D1_2023年_3" value="不同意"></td>
                <td><input type="radio" name="D1_2023年_3" value="中立"></td>
                <td><input type="radio" name="D1_2023年_3" value="同意"></td>
                <td><input type="radio" name="D1_2023年_3" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2024年</td>
                <td><input type="radio" name="D1_2024年_3" value="非常不同意"></td>
                <td><input type="radio" name="D1_2024年_3" value="不同意"></td>
                <td><input type="radio" name="D1_2024年_3" value="中立"></td>
                <td><input type="radio" name="D1_2024年_3" value="同意"></td>
                <td><input type="radio" name="D1_2024年_3" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2025年</td>
                <td><input type="radio" name="D1_2025年_3" value="非常不同意"></td>
                <td><input type="radio" name="D1_2025年_3" value="不同意"></td>
                <td><input type="radio" name="D1_2025年_3" value="中立"></td>
                <td><input type="radio" name="D1_2025年_3" value="同意"></td>
                <td><input type="radio" name="D1_2025年_3" value="非常同意"></td>
              </tr>

              <!-- 表头重复 -->
              <tr class="bg-gray-50">
                <th class="text-left">陈述/年份</th>
                <th>非常不同意</th>
                <th>不同意</th>
                <th>中立</th>
                <th>同意</th>
                <th>非常同意</th>
              </tr>
              
              <!-- AI 对初级岗位替代风险高 -->
              <tr><td colspan="6" class="bg-gray-50 font-semibold">AI 对初级岗位替代风险高</td></tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2023年</td>
                <td><input type="radio" name="D1_2023年_4" value="非常不同意"></td>
                <td><input type="radio" name="D1_2023年_4" value="不同意"></td>
                <td><input type="radio" name="D1_2023年_4" value="中立"></td>
                <td><input type="radio" name="D1_2023年_4" value="同意"></td>
                <td><input type="radio" name="D1_2023年_4" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2024年</td>
                <td><input type="radio" name="D1_2024年_4" value="非常不同意"></td>
                <td><input type="radio" name="D1_2024年_4" value="不同意"></td>
                <td><input type="radio" name="D1_2024年_4" value="中立"></td>
                <td><input type="radio" name="D1_2024年_4" value="同意"></td>
                <td><input type="radio" name="D1_2024年_4" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2025年</td>
                <td><input type="radio" name="D1_2025年_4" value="非常不同意"></td>
                <td><input type="radio" name="D1_2025年_4" value="不同意"></td>
                <td><input type="radio" name="D1_2025年_4" value="中立"></td>
                <td><input type="radio" name="D1_2025年_4" value="同意"></td>
                <td><input type="radio" name="D1_2025年_4" value="非常同意"></td>
              </tr>

              <!-- AI 有助于学习与知识传承 -->
              <tr><td colspan="6" class="bg-gray-50 font-semibold">AI 有助于学习与知识传承</td></tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2023年</td>
                <td><input type="radio" name="D1_2023年_5" value="非常不同意"></td>
                <td><input type="radio" name="D1_2023年_5" value="不同意"></td>
                <td><input type="radio" name="D1_2023年_5" value="中立"></td>
                <td><input type="radio" name="D1_2023年_5" value="同意"></td>
                <td><input type="radio" name="D1_2023年_5" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2024年</td>
                <td><input type="radio" name="D1_2024年_5" value="非常不同意"></td>
                <td><input type="radio" name="D1_2024年_5" value="不同意"></td>
                <td><input type="radio" name="D1_2024年_5" value="中立"></td>
                <td><input type="radio" name="D1_2024年_5" value="同意"></td>
                <td><input type="radio" name="D1_2024年_5" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2025年</td>
                <td><input type="radio" name="D1_2025年_5" value="非常不同意"></td>
                <td><input type="radio" name="D1_2025年_5" value="不同意"></td>
                <td><input type="radio" name="D1_2025年_5" value="中立"></td>
                <td><input type="radio" name="D1_2025年_5" value="同意"></td>
                <td><input type="radio" name="D1_2025年_5" value="非常同意"></td>
              </tr>

              <!-- AI 适合用于注册申报交付环节 -->
              <tr><td colspan="6" class="bg-gray-50 font-semibold">AI 适合用于注册申报交付环节</td></tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2023年</td>
                <td><input type="radio" name="D1_2023年_6" value="非常不同意"></td>
                <td><input type="radio" name="D1_2023年_6" value="不同意"></td>
                <td><input type="radio" name="D1_2023年_6" value="中立"></td>
                <td><input type="radio" name="D1_2023年_6" value="同意"></td>
                <td><input type="radio" name="D1_2023年_6" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2024年</td>
                <td><input type="radio" name="D1_2024年_6" value="非常不同意"></td>
                <td><input type="radio" name="D1_2024年_6" value="不同意"></td>
                <td><input type="radio" name="D1_2024年_6" value="中立"></td>
                <td><input type="radio" name="D1_2024年_6" value="同意"></td>
                <td><input type="radio" name="D1_2024年_6" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2025年</td>
                <td><input type="radio" name="D1_2025年_6" value="非常不同意"></td>
                <td><input type="radio" name="D1_2025年_6" value="不同意"></td>
                <td><input type="radio" name="D1_2025年_6" value="中立"></td>
                <td><input type="radio" name="D1_2025年_6" value="同意"></td>
                <td><input type="radio" name="D1_2025年_6" value="非常同意"></td>
              </tr>

              <!-- 表头重复 -->
              <tr class="bg-gray-50">
                <th class="text-left">陈述/年份</th>
                <th>非常不同意</th>
                <th>不同意</th>
                <th>中立</th>
                <th>同意</th>
                <th>非常同意</th>
              </tr>
              
              <!-- AI 的输出需要严格的人审/双编 -->
              <tr><td colspan="6" class="bg-gray-50 font-semibold">AI 的输出需要严格的人审/双编</td></tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2023年</td>
                <td><input type="radio" name="D1_2023年_7" value="非常不同意"></td>
                <td><input type="radio" name="D1_2023年_7" value="不同意"></td>
                <td><input type="radio" name="D1_2023年_7" value="中立"></td>
                <td><input type="radio" name="D1_2023年_7" value="同意"></td>
                <td><input type="radio" name="D1_2023年_7" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2024年</td>
                <td><input type="radio" name="D1_2024年_7" value="非常不同意"></td>
                <td><input type="radio" name="D1_2024年_7" value="不同意"></td>
                <td><input type="radio" name="D1_2024年_7" value="中立"></td>
                <td><input type="radio" name="D1_2024年_7" value="同意"></td>
                <td><input type="radio" name="D1_2024年_7" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2025年</td>
                <td><input type="radio" name="D1_2025年_7" value="非常不同意"></td>
                <td><input type="radio" name="D1_2025年_7" value="不同意"></td>
                <td><input type="radio" name="D1_2025年_7" value="中立"></td>
                <td><input type="radio" name="D1_2025年_7" value="同意"></td>
                <td><input type="radio" name="D1_2025年_7" value="非常同意"></td>
              </tr>

              <!-- AI 在专业场景下更值得信任 -->
              <tr><td colspan="6" class="bg-gray-50 font-semibold">AI 在专业场景下更值得信任</td></tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2023年</td>
                <td><input type="radio" name="D1_2023年_8" value="非常不同意"></td>
                <td><input type="radio" name="D1_2023年_8" value="不同意"></td>
                <td><input type="radio" name="D1_2023年_8" value="中立"></td>
                <td><input type="radio" name="D1_2023年_8" value="同意"></td>
                <td><input type="radio" name="D1_2023年_8" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2024年</td>
                <td><input type="radio" name="D1_2024年_8" value="非常不同意"></td>
                <td><input type="radio" name="D1_2024年_8" value="不同意"></td>
                <td><input type="radio" name="D1_2024年_8" value="中立"></td>
                <td><input type="radio" name="D1_2024年_8" value="同意"></td>
                <td><input type="radio" name="D1_2024年_8" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2025年</td>
                <td><input type="radio" name="D1_2025年_8" value="非常不同意"></td>
                <td><input type="radio" name="D1_2025年_8" value="不同意"></td>
                <td><input type="radio" name="D1_2025年_8" value="中立"></td>
                <td><input type="radio" name="D1_2025年_8" value="同意"></td>
                <td><input type="radio" name="D1_2025年_8" value="非常同意"></td>
              </tr>

              <!-- 我乐于向团队推广 AI 最佳实践 -->
              <tr><td colspan="6" class="bg-gray-50 font-semibold">我乐于向团队推广 AI 最佳实践</td></tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2023年</td>
                <td><input type="radio" name="D1_2023年_9" value="非常不同意"></td>
                <td><input type="radio" name="D1_2023年_9" value="不同意"></td>
                <td><input type="radio" name="D1_2023年_9" value="中立"></td>
                <td><input type="radio" name="D1_2023年_9" value="同意"></td>
                <td><input type="radio" name="D1_2023年_9" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2024年</td>
                <td><input type="radio" name="D1_2024年_9" value="非常不同意"></td>
                <td><input type="radio" name="D1_2024年_9" value="不同意"></td>
                <td><input type="radio" name="D1_2024年_9" value="中立"></td>
                <td><input type="radio" name="D1_2024年_9" value="同意"></td>
                <td><input type="radio" name="D1_2024年_9" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2025年</td>
                <td><input type="radio" name="D1_2025年_9" value="非常不同意"></td>
                <td><input type="radio" name="D1_2025年_9" value="不同意"></td>
                <td><input type="radio" name="D1_2025年_9" value="中立"></td>
                <td><input type="radio" name="D1_2025年_9" value="同意"></td>
                <td><input type="radio" name="D1_2025年_9" value="非常同意"></td>
              </tr>

              <!-- 表头重复 -->
              <tr class="bg-gray-50">
                <th class="text-left">陈述/年份</th>
                <th>非常不同意</th>
                <th>不同意</th>
                <th>中立</th>
                <th>同意</th>
                <th>非常同意</th>
              </tr>
              
              <!-- 公司应加大 AI 培训与投入 -->
              <tr><td colspan="6" class="bg-gray-50 font-semibold">公司应加大 AI 培训与投入</td></tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2023年</td>
                <td><input type="radio" name="D1_2023年_10" value="非常不同意"></td>
                <td><input type="radio" name="D1_2023年_10" value="不同意"></td>
                <td><input type="radio" name="D1_2023年_10" value="中立"></td>
                <td><input type="radio" name="D1_2023年_10" value="同意"></td>
                <td><input type="radio" name="D1_2023年_10" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2024年</td>
                <td><input type="radio" name="D1_2024年_10" value="非常不同意"></td>
                <td><input type="radio" name="D1_2024年_10" value="不同意"></td>
                <td><input type="radio" name="D1_2024年_10" value="中立"></td>
                <td><input type="radio" name="D1_2024年_10" value="同意"></td>
                <td><input type="radio" name="D1_2024年_10" value="非常同意"></td>
              </tr>
              <tr>
                <td class="indent-row font-normal text-gray-600">2025年</td>
                <td><input type="radio" name="D1_2025年_10" value="非常不同意"></td>
                <td><input type="radio" name="D1_2025年_10" value="不同意"></td>
                <td><input type="radio" name="D1_2025年_10" value="中立"></td>
                <td><input type="radio" name="D1_2025年_10" value="同意"></td>
                <td><input type="radio" name="D1_2025年_10" value="非常同意"></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- D2 单选题 -->
        <div>
          <label class="font-bold">您预计未来 3-5 年 AI 在统计编程行业的影响（单选）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="radio" name="D2" value="A"> 增加对人工统计编程的要求，扩展统计编程组的工作范围</label>
            <label class="flex items-center gap-2"><input type="radio" name="D2" value="B"> 减少对人工统计编程的需求，收缩统计编程组的工作范围</label>
            <label class="flex items-center gap-2"><input type="radio" name="D2" value="C"> 进一步增强生产力，形成行业刚需</label>
            <label class="flex items-center gap-2"><input type="radio" name="D2" value="D"> 有助提升，但影响有限</label>
            <label class="flex items-center gap-2"><input type="radio" name="D2" value="E"> 与现有工具类似，不会显著改变行业</label>
            <label class="flex items-center gap-2"><input type="radio" name="D2" value="F"> 可能带来负面影响（如技能退化、过度依赖）</label>
            <label class="flex items-center gap-2"><input type="radio" name="D2" value="G"> 不确定/难以预测</label>
          </div>
        </div>

        <!-- D3 多选题 -->
        <div>
          <label class="font-bold">您认为哪些因素最制约 AI 在统计编程中的应用（多选，最多3项）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" name="D3" value="A"> 数据安全与隐私合规风险</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="D3" value="B"> AI输出的准确性与可信度不足</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="D3" value="C"> 缺乏针对性的AI工具与平台</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="D3" value="D"> 公司政策限制或缺乏明确指导</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="D3" value="E"> 团队技能与培训不足</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="D3" value="F"> 成本考虑（license、计算资源等）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="D3" value="G"> 审计追踪与可重现性要求</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="D3" value="H"> 监管部门对AI使用的不确定态度</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="D3" value="I"> <span>其他：</span><input type="text" name="D3-OTHER" class="border rounded px-2 py-1 text-sm ml-2 flex-1" placeholder="请填写" disabled></label>
          </div>
        </div>

        <!-- D4 多选题 -->
        <div>
          <label class="font-bold">您倾向于在哪些情境下更信任 AI 的建议（多选）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" name="D4" value="A"> 重复性高、标准化的编程任务</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="D4" value="B"> 有明确业务逻辑、可校验的分析</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="D4" value="C"> 初期探索、获取灵感的阶段</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="D4" value="D"> 有充足时间进行验证的项目</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="D4" value="E"> 都不信任，仅作参考</label>
          </div>
        </div>

        <!-- Next按钮 -->
        <div class="mt-6 text-center">
          <button type="button" id="nextToOutlookSection" class="btn btn-primary">下一步：展望与建议 →</button>
        </div>
        </div>
      </div>

      <!-- E. 展望与建议 -->
      <div id="blockE" class="section-card hidden">
        <h2 class="section-title">🔮 展望与建议</h2>
        <div class="p-6 space-y-6">

        <!-- E1 多选题 -->
        <div data-tags="观望者,初级用户,深度用户,决策者">
          <label class="font-bold">您认为最需要 AI 改进的统计编程环节（多选，最多3项）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" name="E1" value="A"> 代码生成与优化（提高代码质量与效率）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="E1" value="B"> 数据清洗与转换的自动化</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="E1" value="C"> 质量控制与校验（QC自动化）</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="E1" value="D"> 技术文档生成与维护</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="E1" value="E"> 知识管理与最佳实践检索</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="E1" value="F"> 合规性检查与风险评估</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="E1" value="G"> 培训与技能提升辅助</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="E1" value="H"> <span>其他：</span><input type="text" name="E1-OTHER" class="border rounded px-2 py-1 text-sm ml-2 flex-1" placeholder="请填写" disabled></label>
          </div>
        </div>

        <!-- E2 多选题 -->
        <div data-tags="观望者,初级用户,深度用户,决策者">
          <label class="font-bold">您对公司 AI 政策的建议（多选）<span class="required-star">*</span></label>
          <div class="mt-2 space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" name="E2" value="A"> 制定更明确的使用指南与边界</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="E2" value="B"> 加大 AI 工具与基础设施投入</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="E2" value="C"> 增加相关培训与能力建设</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="E2" value="D"> 建立最佳实践分享与交流机制</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="E2" value="E"> 保持现状，观望发展</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="E2" value="F"> 更谨慎使用，加强风险控制</label>
          </div>
        </div>

        <!-- E3 开放题 -->
        <div data-tags="深度用户,决策者">
          <label class="font-bold">如果让您向同行推荐，您会如何描述 AI 在统计编程中的价值？</label>
          <textarea name="E3" rows="3" class="w-full border rounded px-2 py-1 text-sm mt-2" placeholder="可选填写，如'AI帮我提升了...，但需要注意...'"></textarea>
        </div>

        <!-- E4 排序题 -->
        <div data-tags="观望者,初级用户,深度用户,决策者">
          <label class="font-bold">以下哪个 AI 发展方向对您最有吸引力（拖拽排序，1最重要）<span class="required-star">*</span></label>
          <p class="text-sm text-gray-600 mt-1">请拖拽下方选项进行排序，排在最上方的为最重要（移动端：长按拖拽）</p>
          <ul id="E4_sortable" class="mt-3 space-y-2">
            <li class="sortable-item bg-gray-50 border rounded p-3 cursor-move flex items-center" data-value="A">
              <span class="drag-handle mr-3 text-gray-400">⋮⋮</span>
              <span class="rank-number bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3">1</span>
              <span>更准确的领域专用模型</span>
            </li>
            <li class="sortable-item bg-gray-50 border rounded p-3 cursor-move flex items-center" data-value="B">
              <span class="drag-handle mr-3 text-gray-400">⋮⋮</span>
              <span class="rank-number bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3">2</span>
              <span>更强的代码理解与生成能力</span>
            </li>
            <li class="sortable-item bg-gray-50 border rounded p-3 cursor-move flex items-center" data-value="C">
              <span class="drag-handle mr-3 text-gray-400">⋮⋮</span>
              <span class="rank-number bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3">3</span>
              <span>更好的安全性与隐私保护</span>
            </li>
            <li class="sortable-item bg-gray-50 border rounded p-3 cursor-move flex items-center" data-value="D">
              <span class="drag-handle mr-3 text-gray-400">⋮⋮</span>
              <span class="rank-number bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3">4</span>
              <span>更便宜的使用成本</span>
            </li>
            <li class="sortable-item bg-gray-50 border rounded p-3 cursor-move flex items-center" data-value="E">
              <span class="drag-handle mr-3 text-gray-400">⋮⋮</span>
              <span class="rank-number bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3">5</span>
              <span>更完善的生态与工具集成</span>
            </li>
          </ul>
          <input type="hidden" name="E4_A" value="1">
          <input type="hidden" name="E4_B" value="2">
          <input type="hidden" name="E4_C" value="3">
          <input type="hidden" name="E4_D" value="4">
          <input type="hidden" name="E4_E" value="5">
        </div>

        <!-- Next按钮 -->
        <div class="mt-6 text-center">
          <button type="button" id="nextToFinalSection" class="btn btn-primary">下一步：职业概况 →</button>
        </div>
        </div>
      </div>

      <!-- G. 职业概况 -->
      <div id="blockG" class="section-card hidden">
        <h2 class="section-title">👔 职业概况</h2>
        <div class="p-6 space-y-6">

        <div>
          <label class="font-bold">您的主要岗位级别（单选）<span class="required-star">*</span></label>
          <div class="mt-2 grid grid-cols-1 md:grid-cols-2 gap-1">
            <label><input type="radio" name="B2" value="A"> 初级/助理</label>
            <label><input type="radio" name="B2" value="B"> 中级/资深</label>
            <label><input type="radio" name="B2" value="C"> 主管/组长</label>
            <label><input type="radio" name="B2" value="D"> 经理/负责人</label>
            <label><input type="radio" name="B2" value="E"> 总监及以上</label>
          </div>
        </div>

        <div>
          <label class="font-bold">您的行业从业年限（单选）<span class="required-star">*</span></label>
          <div class="mt-2 grid grid-cols-1 md:grid-cols-3 gap-1">
            <label><input type="radio" name="B3" value="A"> 0–2 年</label>
            <label><input type="radio" name="B3" value="B"> 3–5 年</label>
            <label><input type="radio" name="B3" value="C"> 6–9 年</label>
            <label><input type="radio" name="B3" value="D"> 10–14 年</label>
            <label><input type="radio" name="B3" value="E"> 15 年及以上</label>
          </div>
        </div>

        <div>
          <label class="font-bold">您常用的编程语言/工具（多选）<span class="required-star">*</span></label>
          <div class="mt-2 grid grid-cols-1 md:grid-cols-3 gap-1">
            <label><input type="checkbox" name="B4" value="A"> SAS</label>
            <label><input type="checkbox" name="B4" value="B"> R</label>
            <label><input type="checkbox" name="B4" value="C"> Python</label>
            <label><input type="checkbox" name="B4" value="D"> SQL</label>
            <label><input type="checkbox" name="B4" value="E"> Julia</label>
            <label class="flex items-center gap-2"><input type="checkbox" name="B4" value="F"> <span>其他：</span><input type="text" name="B4-OTHER" class="border rounded px-2 py-1 text-sm flex-1" placeholder="请填写" disabled></label>
          </div>
        </div>

        <div>
          <label class="font-bold">您当前主要涉及的治疗领域（多选）<span class="required-star">*</span></label>
          <div class="mt-2 grid grid-cols-1 md:grid-cols-3 gap-1">
            <label><input type="checkbox" name="B5" value="A"> 肿瘤</label>
            <label><input type="checkbox" name="B5" value="B"> 免疫</label>
            <label><input type="checkbox" name="B5" value="C"> 代谢</label>
            <label><input type="checkbox" name="B5" value="D"> 心血管</label>
            <label><input type="checkbox" name="B5" value="E"> 神经</label>
            <label><input type="checkbox" name="B5" value="F"> 感染</label>
            <label><input type="checkbox" name="B5" value="G"> 罕见病</label>
            <label><input type="checkbox" name="B5" value="H"> 其他/不固定</label>
          </div>
        </div>
        </div>
      </div>

      <!-- F. 开放反馈 -->
      <div id="blockF" class="section-card hidden">
        <h2 class="section-title">💬 开放反馈</h2>
        <div class="p-6 space-y-4">
        
        <div>
          <label class="font-bold">您对本次调研或 AI 在统计编程领域的其他建议：</label>
          <textarea name="F1" rows="4" class="w-full border rounded px-2 py-1 text-sm mt-2" placeholder="可选填写您的任何建议、意见或补充..."></textarea>
        </div>
        </div>
      </div>

      <!-- 提交区域 -->
      <div id="submitSection" class="section-card hidden">
        <div class="p-6">
        <div class="text-center">
          <button type="submit" class="btn btn-primary">📤 提交问卷</button>
          <div class="mt-3">
            <span class="text-sm text-gray-500">提交前请检查必填项是否完整</span>
          </div>
        </div>
        
        <div class="mt-4 text-xs text-gray-500">
          <p>* 问卷数据将用于学术研究，不会泄露个人隐私信息</p>
          <p>* 如有疑问，请<a href="mailto:jsong67@its.jnj.com;CTian17@ITS.JNJ.com;hao1.chen@beigene.com?subject=中国药物研发统计编程行业AI使用与态度问卷咨询" class="text-blue-600 hover:text-blue-800 underline">联系我们</a></p>
        </div>
        </div>
      </div>
    </form>

    <!-- 提交成功提示 -->
    <div id="submitSuccess" class="hidden section-card mt-6">
      <div class="p-8 text-center">
        <div class="text-6xl mb-4">🎉</div>
        <h3 class="text-2xl font-bold text-green-800 mb-4">问卷已完成！</h3>
        <p class="text-green-700 text-lg mb-6">感谢您的参与！</p>
        <div class="text-green-600 space-y-3 mb-6">
          <p class="text-base font-medium">📅 调查结果将于 <strong>2025年11月7日</strong> 发布</p>
          <p>🌍 发布地点：PHUSE SDE 及线上同时发布</p>
        </div>
        <button id="showReportBtn" class="btn btn-primary mb-4">📊 查看当前调查结果汇总</button>
      </div>
    </div>

    <!-- 调查结果报告 -->
    <div id="surveyReport" class="hidden section-card mt-6">
      <div class="p-6">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-2xl font-bold text-gray-800">📊 调查结果汇总报告</h3>
          <button id="closeReportBtn" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>
        <div id="reportContent" class="space-y-6">
          <div class="text-center py-8">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-600">正在加载调查数据...</p>
          </div>
        </div>
      </div>
    </div>


    
    </div>
    
    <!-- Contact Us -->
    <footer class="bg-gray-100 border-t p-6">
    </footer>
  </div>

  <script>
    // Firebase配置
    const firebaseConfig = {
      apiKey: "{{API_KEY}}",
      authDomain: "phuse-ai-survey.firebaseapp.com",
      databaseURL: "https://phuse-ai-survey-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "phuse-ai-survey",
      storageBucket: "phuse-ai-survey.firebasestorage.app",
      messagingSenderId: "924577570091",
      appId: "1:924577570091:web:d7a96aa331b86ccc4b796e",
      measurementId: "G-X54Z7YHTDC"
    };
    
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('surveyForm');
      const submitSuccess = document.getElementById('submitSuccess');
      
      // S5 逻辑 - 根据AI使用频率显示/隐藏S6题目并更新按钮
      const s5Inputs = document.querySelectorAll('input[name="S5"]');
      const s6Question = document.getElementById('S6Question');
      const nextBtn = document.getElementById('nextToAISection');
      
      s5Inputs.forEach(input => {
        input.addEventListener('change', function() {
          if (this.value === 'A' && this.checked) {
            // 选择"从不"，隐藏S6题目
            s6Question.classList.add('hidden');
            // 清除S6的选择
            document.querySelectorAll('input[name="S6"]').forEach(s6Input => {
              s6Input.checked = false;
            });
            document.querySelector('input[name="S6-OTHER"]').value = '';
            
            // 更新按钮为观望者模式
            nextBtn.textContent = '下一步：AI态度 →';
          } else if (this.checked) {
            // 选择其他选项，显示S6题目
            s6Question.classList.remove('hidden');
            
            // 恢复按钮为正常模式
            nextBtn.textContent = '下一步：AI使用情况 →';
          }
        });
      });
      
      // S1 逻辑 - 选择"否"时显示结束消息并隐藏后续问题
      const s1Inputs = document.querySelectorAll('input[name="S1"]');
      
      s1Inputs.forEach(input => {
        input.addEventListener('change', function() {
          const endMsg = document.getElementById('endMsgS1');
          const nextBtn = document.getElementById('nextToAISection');
          if (this.value === 'B' && this.checked) {
            endMsg.classList.remove('hidden');
            nextBtn.style.display = 'none';
            // 隐藏除第一题以外的所有题目
            document.querySelectorAll('#blockA > div:nth-child(n+3)').forEach(el => el.classList.add('hidden'));
          } else {
            endMsg.classList.add('hidden');
            nextBtn.style.display = 'inline-block';
            // 显示基本信息section的所有题目
            document.querySelectorAll('#blockA > div:nth-child(n+3)').forEach(el => el.classList.remove('hidden'));
          }
        });
      });
      
      // Next按钮点击事件 - 验证基本信息section必填项
      document.getElementById('nextToAISection').addEventListener('click', function() {
        // 检查是否为观望者模式（按钮文本包含"AI态度"）
        if (this.textContent.includes('AI态度')) {
          // 观望者模式，直接跳转到态度section
          const userTags = generateUserTags();
          displayUserTags(userTags);
          
          document.getElementById('blockA').classList.add('hidden');
          document.getElementById('blockD').classList.remove('hidden');
          document.getElementById('blockD').scrollIntoView({ behavior: 'smooth' });
          return;
        }
        // 清除之前的验证提示
        document.querySelectorAll('.validation-error').forEach(el => el.remove());
        
        // 定义基本信息section的必填项
        const basicInfoRequired = [
          {name: 'S1', type: 'radio'},
          {name: 'S2', type: 'radio'},
          {name: 'S3', type: 'checkbox'},
          {name: 'S5', type: 'radio'}
        ];
        
        // 如果S6题目可见，则添加到必填项中
        if (!document.getElementById('S6Question').classList.contains('hidden')) {
          basicInfoRequired.push({name: 'S6', type: 'checkbox'});
        }
        
        let firstInvalidField = null;
        let isValid = true;
        
        // 验证每个必填项，使用与提交时相同的逻辑
        basicInfoRequired.forEach(q => {
          let hasValue = false;
          let firstInput = null;
          let targetElement = null;
          
          const inputs = form.querySelectorAll(`input[name="${q.name}"]`);
          hasValue = Array.from(inputs).some(input => input.checked);
          firstInput = inputs[0];
          
          if (firstInput) {
            // 向上查找包含label.font-bold的div
            let currentDiv = firstInput.closest('div');
            while (currentDiv && !currentDiv.querySelector('label.font-bold')) {
              currentDiv = currentDiv.parentElement.closest('div');
            }
            targetElement = currentDiv ? currentDiv.querySelector('label.font-bold') : null;
          }
          
          if (!hasValue && targetElement) {
            const errorMsg = document.createElement('p');
            errorMsg.className = 'validation-error mt-2 text-sm text-red-600';
            errorMsg.textContent = '请至少选择一项！';
            targetElement.after(errorMsg);
            
            if (!firstInvalidField) {
              firstInvalidField = firstInput ? firstInput.closest('div') : null;
            }
            isValid = false;
          }
        });
        
        if (!isValid) {
          // 滚动到第一个未填的题目
          if (firstInvalidField) {
            firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
          return;
        }
        
        // 验证通过，根据用户回答给用户打标签
        const userTags = generateUserTags();
        console.log('用户标签:', userTags);
        
        // 显示用户标签
        displayUserTags(userTags);
        
        // 根据标签调整跳转逻辑
        const nextBtn = document.getElementById('nextToAISection');
        if (userTags.includes('观望者')) {
          // 观望者直接跳转到态度section
          document.getElementById('blockA').classList.add('hidden');
          document.getElementById('blockD').classList.remove('hidden');
          document.getElementById('blockD').scrollIntoView({ behavior: 'smooth' });
        } else {
          // 根据标签决定显示哪些sections
          showSectionsBasedOnTags(userTags);
        }
        
        // 滚动到AI使用情况section的顶部
        if (!userTags.includes('观望者')) {
          document.getElementById('blockC').scrollIntoView({ behavior: 'smooth' });
        }
      });
      

      
      // 用户标签生成函数
      function generateUserTags() {
        const tags = [];
        
        // 根据S3（工作内容）打标签
        const s3Selected = document.querySelectorAll('input[name="S3"]:checked');
        if (s3Selected.length > 0) {
          const workTypes = Array.from(s3Selected).map(input => input.value);
          // 选择 工具与宏/包开发与维护（SAS/R/Python）就加tag "深度用户"
          if (workTypes.includes('E')) {
            tags.push('深度用户');
          }
          // 选择 项目管理 或 带人经理/团队管理 就加tag "决策者"
          if (workTypes.includes('F') || workTypes.includes('G')) {
            tags.push('决策者');
          }
        }
        
        // 根据S5（AI使用频率）打标签
        const s5Selected = document.querySelector('input[name="S5"]:checked');
        if (s5Selected) {
          switch(s5Selected.value) {
            case 'A': tags.push('观望者'); break; // 从不
            case 'B': tags.push('初级用户'); break; // 很少（每季度或更少）
            case 'C': tags.push('初级用户'); break; // 偶尔（每月）
            case 'D': tags.push('深度用户'); break; // 经常（每周）
            case 'E': tags.push('深度用户'); break; // 频繁（几乎每天）
          }
        }
        
        // 根据S6（AI任务类型）打标签
        const s6Selected = document.querySelectorAll('input[name="S6"]:checked');
        if (s6Selected.length > 0) {
          const taskTypes = Array.from(s6Selected).map(input => input.value);
          // 选择自动化工作流/工具集成（API、LangChain、自建 Agent）加tag深度用户
          if (taskTypes.includes('E')) {
            tags.push('深度用户');
          }
          // 内部知识库/RAG（如 SOP/模板/最佳实践检索）加tag深度用户
          if (taskTypes.includes('F')) {
            tags.push('深度用户');
          }
          // 选择 模型微调/本地化部署/私有化 加tag深度用户
          if (taskTypes.includes('G')) {
            tags.push('深度用户');
          }
          // 选择 风险与合规评估/代码校验辅助 加tag深度用户
          if (taskTypes.includes('H')) {
            tags.push('深度用户');
          }
        }
        
        // 去重
        return [...new Set(tags)];
      }
      
      // 显示用户标签
      function displayUserTags(tags) {
        const tagsSection = document.getElementById('userTagsSection');
        const tagsDisplay = document.getElementById('userTagsDisplay');
        
        if (tags.length > 0) {
          tagsDisplay.innerHTML = '';
          tags.forEach(tag => {
            const tagElement = document.createElement('span');
            tagElement.className = 'inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium';
            tagElement.textContent = tag;
            tagsDisplay.appendChild(tagElement);
          });
          tagsSection.classList.remove('hidden');
        }
      }
      
      // 根据标签显示/隐藏题目
      function filterQuestionsByTags(tags) {
        // 获取所有带有data-tags属性的题目
        const questions = document.querySelectorAll('[data-tags]');
        
        questions.forEach(question => {
          const requiredTags = question.getAttribute('data-tags').split(',').map(tag => tag.trim());
          // 检查用户是否有任何一个需要的标签（OR关系）
          const hasRequiredTag = requiredTags.some(tag => tags.includes(tag));
          
          if (hasRequiredTag) {
            question.style.display = 'block';
          } else {
            question.style.display = 'none';
          }
        });
      }
      
      // 根据标签决定显示哪些sections
      function showSectionsBasedOnTags(tags) {
        // 隐藏基本信息section，只显示下一个section（AI使用情况）
        document.getElementById('blockA').classList.add('hidden');
        document.getElementById('blockC').classList.remove('hidden');
        
        // 根据标签过滤题目
        filterQuestionsByTags(tags);
        
        // 根据标签调整显示逻辑（可以根据需要扩展）
        if (tags.includes('观望者')) {
          console.log('用户从不使用AI，可以调整问卷流程');
        }
        
        if (tags.includes('深度用户')) {
          console.log('用户是深度AI用户，将显示深度用户专项');
        }
        
        if (tags.includes('决策者')) {
          console.log('用户是决策者，可以调整相关问题');
        }
      }
      
      // 验证可见题目的函数
      function validateVisibleSection(requiredQuestions, targetElement) {
        console.log('开始验证可见section');
        document.querySelectorAll('.validation-error').forEach(el => el.remove());
        
        let firstInvalidField = null;
        let isValid = true;
        
        // 获取当前用户标签
        const userTags = generateUserTags();
        console.log('当前用户标签:', userTags);
        
        // 只验证当前可见的必填题目
        const visibleRequiredQuestions = requiredQuestions.filter(q => {
          const firstInput = form.querySelector(`input[name="${q.name}"]`);
          if (!firstInput) {
            console.log(`找不到输入框: ${q.name}`);
            return false;
          }
          
          const questionDiv = firstInput.closest('div[data-tags], div:not([data-tags])');
          // 如果题目有data-tags属性，检查用户是否有对应标签
          if (questionDiv && questionDiv.hasAttribute('data-tags')) {
            const requiredTags = questionDiv.getAttribute('data-tags').split(',').map(tag => tag.trim());
            const hasRequiredTag = requiredTags.some(tag => userTags.includes(tag));
            if (!hasRequiredTag || questionDiv.style.display === 'none') {
              console.log(`跳过隐藏题目: ${q.name}`);
              return false;
            }
          }
          console.log(`包含可见题目: ${q.name}`);
          return true;
        });
        
        console.log(`可见必填题目数量: ${visibleRequiredQuestions.length}`);
        
        visibleRequiredQuestions.forEach(q => {
          let hasValue = false;
          let errorTarget = null;
          const firstInput = form.querySelector(`input[name="${q.name}"]`);
          
          if (q.type === 'checkbox-column') {
            const year = q.name.split('_')[1];
            const columnInputs = form.querySelectorAll(`input[name^="C2_"][name$="_${year}"]`);
            hasValue = Array.from(columnInputs).some(input => input.checked);
            
            if (firstInput) {
              const table = firstInput.closest('table');
              const thead = table.querySelector('thead tr');
              const thCells = thead.querySelectorAll('th');
              thCells.forEach((th, index) => {
                if (th.textContent.includes(year)) {
                  errorTarget = th;
                }
              });
            }
          } else {
            const inputs = form.querySelectorAll(`input[name="${q.name}"]`);
            hasValue = Array.from(inputs).some(input => input.checked);
            
            if (firstInput && (q.name.includes('C1_') || q.name.includes('C3_') || q.name.includes('C4_') || q.name.includes('D1_') || q.name.includes('CD5_'))) {
              const row = firstInput.closest('tr');
              if (row) {
                errorTarget = row.querySelector('td:first-child');
              }
            } else if (firstInput) {
              let currentDiv = firstInput.closest('div');
              while (currentDiv && !currentDiv.querySelector('label.font-bold')) {
                currentDiv = currentDiv.parentElement.closest('div');
              }
              errorTarget = currentDiv ? currentDiv.querySelector('label.font-bold') : null;
            }
          }
          
          if (!hasValue && errorTarget) {
            const errorMsg = document.createElement('p');
            errorMsg.className = 'validation-error mt-2 text-sm text-red-600';
            errorMsg.textContent = '请至少选择一项！';
            
            if (errorTarget.tagName === 'TD' || errorTarget.tagName === 'TH') {
              errorTarget.appendChild(errorMsg);
            } else {
              errorTarget.after(errorMsg);
            }
            
            if (!firstInvalidField) {
              firstInvalidField = firstInput ? firstInput.closest('div, tr') : null;
            }
            isValid = false;
          }
        });
        
        if (!isValid && firstInvalidField) {
          console.log('验证失败，滚动到错误位置');
          firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
          return false;
        }
        
        if (isValid && targetElement) {
          console.log('验证成功，跳转到下一个section');
          document.querySelectorAll('#blockA, #blockC, #blockD, #blockE, #blockG, #blockF, #submitSection').forEach(el => {
            el.classList.add('hidden');
          });
          targetElement.classList.remove('hidden');
          targetElement.scrollIntoView({ behavior: 'smooth' });
        }
        
        console.log(`验证结果: ${isValid}`);
        return isValid;
      }
      
      // 通用验证函数
      function validateSection(requiredQuestions, targetElement) {
        document.querySelectorAll('.validation-error').forEach(el => el.remove());
        
        let firstInvalidField = null;
        let isValid = true;
        
        requiredQuestions.forEach(q => {
          let hasValue = false;
          let firstInput = null;
          let errorTarget = null;
          
          if (q.type === 'checkbox-column') {
            const year = q.name.split('_')[1];
            const columnInputs = form.querySelectorAll(`input[name^="C2_"][name$="_${year}"]`);
            hasValue = Array.from(columnInputs).some(input => input.checked);
            firstInput = columnInputs[0];
            
            if (firstInput) {
              const table = firstInput.closest('table');
              const thead = table.querySelector('thead tr');
              const thCells = thead.querySelectorAll('th');
              thCells.forEach((th, index) => {
                if (th.textContent.includes(year)) {
                  errorTarget = th;
                }
              });
            }
          } else {
            const inputs = form.querySelectorAll(`input[name="${q.name}"]`);
            hasValue = Array.from(inputs).some(input => input.checked);
            firstInput = inputs[0];
            
            if (firstInput && (q.name.includes('C1_') || q.name.includes('C3_') || q.name.includes('C4_') || q.name.includes('D1_') || q.name.includes('CD5_'))) {
              const row = firstInput.closest('tr');
              if (row) {
                errorTarget = row.querySelector('td:first-child');
              }
            } else if (firstInput) {
              let currentDiv = firstInput.closest('div');
              while (currentDiv && !currentDiv.querySelector('label.font-bold')) {
                currentDiv = currentDiv.parentElement.closest('div');
              }
              errorTarget = currentDiv ? currentDiv.querySelector('label.font-bold') : null;
            }
          }
          
          if (!hasValue && errorTarget) {
            const errorMsg = document.createElement('p');
            errorMsg.className = 'validation-error mt-2 text-sm text-red-600';
            errorMsg.textContent = '请至少选择一项！';
            
            if (errorTarget.tagName === 'TD' || errorTarget.tagName === 'TH') {
              errorTarget.appendChild(errorMsg);
            } else {
              errorTarget.after(errorMsg);
            }
            
            if (!firstInvalidField) {
              firstInvalidField = firstInput ? firstInput.closest('div, tr') : null;
            }
            isValid = false;
          }
        });
        
        if (!isValid && firstInvalidField) {
          firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
          return false;
        }
        
        if (isValid && targetElement) {
          // 隐藏所有sections，只显示目标section
          document.querySelectorAll('#blockA, #blockC, #blockD, #blockE, #blockG, #blockF, #submitSection').forEach(el => {
            el.classList.add('hidden');
          });
          targetElement.classList.remove('hidden');
          targetElement.scrollIntoView({ behavior: 'smooth' });
        }
        
        return isValid;
      }
      
      // AI使用情况section验证
      document.getElementById('nextToAttitudeSection').addEventListener('click', function() {
        console.log('点击了下一步按钮');
        
        // 定义所有可能的必填题目及其标签要求
        const allPossibleQuestions = [
          // 深度用户专用题目
          {name: 'C1_2023', type: 'radio', tags: ['深度用户']},
          {name: 'C1_2024', type: 'radio', tags: ['深度用户']},
          {name: 'C1_2025', type: 'radio', tags: ['深度用户']},
          {name: 'C2_2023', type: 'checkbox-column', tags: ['深度用户']},
          {name: 'C2_2024', type: 'checkbox-column', tags: ['深度用户']},
          {name: 'C2_2025', type: 'checkbox-column', tags: ['深度用户']},
          {name: 'C3_2023', type: 'radio', tags: ['深度用户']},
          {name: 'C3_2024', type: 'radio', tags: ['深度用户']},
          {name: 'C3_2025', type: 'radio', tags: ['深度用户']},
          {name: 'C4_2023', type: 'radio', tags: ['深度用户']},
          {name: 'C4_2024', type: 'radio', tags: ['深度用户']},
          {name: 'C4_2025', type: 'radio', tags: ['深度用户']},
          // 初级用户和深度用户共同题目
          {name: 'C5', type: 'checkbox', tags: ['初级用户', '深度用户']},
          {name: 'C6', type: 'radio', tags: ['初级用户', '深度用户']},
          {name: 'C7', type: 'checkbox', tags: ['初级用户', '深度用户']},
          // 深度用户专用题目
          {name: 'CD1', type: 'checkbox', tags: ['深度用户']},
          {name: 'CD2', type: 'radio', tags: ['深度用户']},
          {name: 'CD3', type: 'checkbox', tags: ['深度用户']},
          {name: 'CD4', type: 'radio', tags: ['深度用户']},
          {name: 'CD5_simple', type: 'radio', tags: ['深度用户']},
          {name: 'CD5_medium', type: 'radio', tags: ['深度用户']},
          {name: 'CD5_complex', type: 'radio', tags: ['深度用户']},
          // 深度用户和决策者共同题目
          {name: 'CD7', type: 'checkbox', tags: ['深度用户', '决策者']},
          {name: 'CD8', type: 'radio', tags: ['深度用户', '决策者']}
        ];
        
        // 获取当前用户标签
        const userTags = generateUserTags();
        console.log('当前用户标签:', userTags);
        
        // 过滤出用户应该验证的题目
        const userRequiredQuestions = allPossibleQuestions.filter(q => {
          if (!q.tags) return true; // 没有标签要求的题目都需要验证
          return q.tags.some(tag => userTags.includes(tag)); // 用户有对应标签的题目
        });
        
        console.log('用户应验证题目数量:', userRequiredQuestions.length);
        
        validateVisibleSection(userRequiredQuestions, document.getElementById('blockD'));
      });
      

      
      // AI态度section验证
      document.getElementById('nextToOutlookSection').addEventListener('click', function() {
        const attitudeRequired = [
          {name: 'D1_2023年_1', type: 'radio'},
          {name: 'D1_2024年_1', type: 'radio'},
          {name: 'D1_2025年_1', type: 'radio'},
          {name: 'D1_2023年_2', type: 'radio'},
          {name: 'D1_2024年_2', type: 'radio'},
          {name: 'D1_2025年_2', type: 'radio'},
          {name: 'D1_2023年_3', type: 'radio'},
          {name: 'D1_2024年_3', type: 'radio'},
          {name: 'D1_2025年_3', type: 'radio'},
          {name: 'D1_2023年_4', type: 'radio'},
          {name: 'D1_2024年_4', type: 'radio'},
          {name: 'D1_2025年_4', type: 'radio'},
          {name: 'D1_2023年_5', type: 'radio'},
          {name: 'D1_2024年_5', type: 'radio'},
          {name: 'D1_2025年_5', type: 'radio'},
          {name: 'D1_2023年_6', type: 'radio'},
          {name: 'D1_2024年_6', type: 'radio'},
          {name: 'D1_2025年_6', type: 'radio'},
          {name: 'D1_2023年_7', type: 'radio'},
          {name: 'D1_2024年_7', type: 'radio'},
          {name: 'D1_2025年_7', type: 'radio'},
          {name: 'D1_2023年_8', type: 'radio'},
          {name: 'D1_2024年_8', type: 'radio'},
          {name: 'D1_2025年_8', type: 'radio'},
          {name: 'D1_2023年_9', type: 'radio'},
          {name: 'D1_2024年_9', type: 'radio'},
          {name: 'D1_2025年_9', type: 'radio'},
          {name: 'D1_2023年_10', type: 'radio'},
          {name: 'D1_2024年_10', type: 'radio'},
          {name: 'D1_2025年_10', type: 'radio'},
          {name: 'D2', type: 'radio'},
          {name: 'D3', type: 'checkbox'},
          {name: 'D4', type: 'checkbox'}
        ];
        
        validateSection(attitudeRequired, document.getElementById('blockE'));
      });
      
      // 展望与建议section验证
      document.getElementById('nextToFinalSection').addEventListener('click', function() {
        const outlookRequired = [
          {name: 'E1', type: 'checkbox'},
          {name: 'E2', type: 'checkbox'}
        ];
        
        // 清除之前的验证提示
        document.querySelectorAll('.validation-error').forEach(el => el.remove());
        
        let firstInvalidField = null;
        let isValid = true;
        
        outlookRequired.forEach(q => {
          let hasValue = false;
          let firstInput = null;
          let targetElement = null;
          
          const inputs = form.querySelectorAll(`input[name="${q.name}"]`);
          hasValue = Array.from(inputs).some(input => input.checked);
          firstInput = inputs[0];
          
          if (firstInput) {
            let currentDiv = firstInput.closest('div');
            while (currentDiv && !currentDiv.querySelector('label.font-bold')) {
              currentDiv = currentDiv.parentElement.closest('div');
            }
            targetElement = currentDiv ? currentDiv.querySelector('label.font-bold') : null;
          }
          
          if (!hasValue && targetElement) {
            const errorMsg = document.createElement('p');
            errorMsg.className = 'validation-error mt-2 text-sm text-red-600';
            errorMsg.textContent = '请至少选择一项！';
            targetElement.after(errorMsg);
            
            if (!firstInvalidField) {
              firstInvalidField = firstInput ? firstInput.closest('div') : null;
            }
            isValid = false;
          }
        });
        
        if (!isValid) {
          if (firstInvalidField) {
            firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
          return;
        }
        
        // 验证通过，隐藏当前sections，显示最后部分
        document.querySelectorAll('#blockC, #blockD, #blockE').forEach(el => {
          el.classList.add('hidden');
        });
        document.getElementById('blockG').classList.remove('hidden');
        document.getElementById('blockF').classList.remove('hidden');
        document.getElementById('submitSection').classList.remove('hidden');
        document.getElementById('blockG').scrollIntoView({ behavior: 'smooth' });
      });
      
      // 矩阵题目联动逻辑
      function setupMatrixLinkage() {
        // C1频率矩阵的联动逻辑
        ['2023', '2024', '2025'].forEach(year => {
          const frequencyInputs = document.querySelectorAll(`input[name="C1_${year}"]`);
          
          frequencyInputs.forEach(input => {
            input.addEventListener('change', function() {
              if (this.checked && this.value === '从不') {
                // 选择从不时，自动设置C2和C3
                handleNeverUsedAI(year);
              } else if (this.checked) {
                // 选择其他选项时，恢复正常状态
                restoreNormalState(year);
              }
            });
          });
        });
      }
      
      function handleNeverUsedAI(year) {
        // C2: 自动勾选"未使用AI"并禁用其他选项
        const c2NeverUsed = document.querySelector(`input[name="C2_未使用AI_${year}"]`);
        if (c2NeverUsed) {
          c2NeverUsed.checked = true;
          
          // 禁用其他C2选项
          document.querySelectorAll(`input[name^="C2_"][name$="_${year}"]:not([name="C2_未使用AI_${year}"])`).forEach(input => {
            input.checked = false;
            input.disabled = true;
            input.closest('td').classList.add('disabled');
          });
        }
        
        // C3: 自动选择"<10%（含0%）"并禁用其他选项
        const c3LowEfficiency = document.querySelector(`input[name="C3_${year}"][value="<10%（含0%）"]`);
        if (c3LowEfficiency) {
          c3LowEfficiency.checked = true;
          
          // 禁用其他C3选项
          document.querySelectorAll(`input[name="C3_${year}"]:not([value="<10%（含0%）"])`).forEach(input => {
            input.checked = false;
            input.disabled = true;
            input.closest('td').classList.add('disabled');
          });
        }
      }
      
      function restoreNormalState(year) {
        // 恢复C2选项
        document.querySelectorAll(`input[name^="C2_"][name$="_${year}"]`).forEach(input => {
          input.disabled = false;
          input.closest('td').classList.remove('disabled');
        });
        
        // 清除自动勾选的"未使用AI"
        const c2NeverUsed = document.querySelector(`input[name="C2_未使用AI_${year}"]`);
        if (c2NeverUsed) {
          c2NeverUsed.checked = false;
        }
        
        // 恢复C3选项
        document.querySelectorAll(`input[name="C3_${year}"]`).forEach(input => {
          input.disabled = false;
          input.closest('td').classList.remove('disabled');
        });
        
        // 清除自动选择的"<10%"
        const c3LowEfficiency = document.querySelector(`input[name="C3_${year}"][value="<10%（含0%）"]`);
        if (c3LowEfficiency) {
          c3LowEfficiency.checked = false;
        }
      }
      
      // 初始化矩阵联动
      setupMatrixLinkage();
      
      // 多选框"其他"选项的文本框联动 - 通用处理所有带文本框的checkbox
      document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        const label = checkbox.parentElement;
        const textInput = label.querySelector('input[type="text"]');
        if (textInput) {
          checkbox.addEventListener('change', function() {
            textInput.disabled = !this.checked;
            if (!this.checked) textInput.value = '';
          });
        }
      });
      

      

      
      // D3 多选限制（最多3项）
      const d3Checkboxes = document.querySelectorAll('input[name="D3"]');
      d3Checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const checkedD3 = document.querySelectorAll('input[name="D3"]:checked');
          if (checkedD3.length > 3) {
            this.checked = false;
            alert('最多只能选择3项');
          }
        });
      });
      
      // E1 多选限制（最多3项）
      const e1Checkboxes = document.querySelectorAll('input[name="E1"]');
      e1Checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const checkedE1 = document.querySelectorAll('input[name="E1"]:checked');
          if (checkedE1.length > 3) {
            this.checked = false;
            alert('最多只能选择3项');
          }
        });
      });
      
      // CD7 多选限制（最多5项）
      const cd7Checkboxes = document.querySelectorAll('input[name="CD7"]');
      cd7Checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const checkedCD7 = document.querySelectorAll('input[name="CD7"]:checked');
          if (checkedCD7.length > 5) {
            this.checked = false;
            alert('最多只能选择5项');
          }
        });
      });
      
      // E4 拖拽排序功能（支持桌面和移动端）
      const sortableList = document.getElementById('E4_sortable');
      let draggedElement = null;
      let touchStartY = 0;
      let touchElement = null;
      
      // 桌面端拖拽
      sortableList.addEventListener('dragstart', function(e) {
        draggedElement = e.target.closest('.sortable-item');
        draggedElement.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
      });
      
      sortableList.addEventListener('dragend', function(e) {
        if (draggedElement) {
          draggedElement.classList.remove('dragging');
          draggedElement = null;
        }
      });
      
      sortableList.addEventListener('dragover', function(e) {
        e.preventDefault();
        const afterElement = getDragAfterElement(sortableList, e.clientY);
        if (afterElement == null) {
          sortableList.appendChild(draggedElement);
        } else {
          sortableList.insertBefore(draggedElement, afterElement);
        }
        updateRankNumbers();
      });
      
      // 移动端触摸支持
      sortableList.addEventListener('touchstart', function(e) {
        touchElement = e.target.closest('.sortable-item');
        if (touchElement) {
          touchStartY = e.touches[0].clientY;
          touchElement.classList.add('dragging');
        }
      });
      
      sortableList.addEventListener('touchmove', function(e) {
        if (!touchElement) return;
        e.preventDefault();
        
        const touch = e.touches[0];
        const afterElement = getDragAfterElement(sortableList, touch.clientY);
        
        if (afterElement == null) {
          sortableList.appendChild(touchElement);
        } else {
          sortableList.insertBefore(touchElement, afterElement);
        }
        updateRankNumbers();
      });
      
      sortableList.addEventListener('touchend', function(e) {
        if (touchElement) {
          touchElement.classList.remove('dragging');
          touchElement = null;
        }
      });
      
      // 使所有排序项可拖拽
      document.querySelectorAll('.sortable-item').forEach(item => {
        item.draggable = true;
        item.style.touchAction = 'none'; // 防止移动端滚动干扰
      });
      
      function getDragAfterElement(container, y) {
        const draggableElements = [...container.querySelectorAll('.sortable-item:not(.dragging)')];
        return draggableElements.reduce((closest, child) => {
          const box = child.getBoundingClientRect();
          const offset = y - box.top - box.height / 2;
          if (offset < 0 && offset > closest.offset) {
            return { offset: offset, element: child };
          } else {
            return closest;
          }
        }, { offset: Number.NEGATIVE_INFINITY }).element;
      }
      
      function updateRankNumbers() {
        const items = document.querySelectorAll('#E4_sortable .sortable-item');
        items.forEach((item, index) => {
          const rankNumber = item.querySelector('.rank-number');
          rankNumber.textContent = index + 1;
          const value = item.dataset.value;
          document.querySelector(`input[name="E4_${value}"]`).value = index + 1;
        });
      }
      

      

      

      // 表单提交处理
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // 清除所有验证提示
        document.querySelectorAll('.validation-error').forEach(el => el.remove());
        
        // 获取当前用户标签
        const userTags = generateUserTags();
        console.log('提交时用户标签:', userTags);
        
        // 定义所有必填项及其标签要求
        const allRequiredQuestions = [
          // 基本信息（所有用户）
          {name: 'S1', type: 'radio'},
          {name: 'S2', type: 'radio'},
          {name: 'S3', type: 'checkbox'},
          {name: 'S5', type: 'radio'},
          {name: 'S6', type: 'checkbox', condition: () => !document.getElementById('S6Question').classList.contains('hidden')},
          // AI使用情况（按标签）
          {name: 'C1_2023', type: 'radio', tags: ['深度用户']},
          {name: 'C1_2024', type: 'radio', tags: ['深度用户']},
          {name: 'C1_2025', type: 'radio', tags: ['深度用户']},
          {name: 'C2_2023', type: 'checkbox-column', tags: ['深度用户']},
          {name: 'C2_2024', type: 'checkbox-column', tags: ['深度用户']},
          {name: 'C2_2025', type: 'checkbox-column', tags: ['深度用户']},
          {name: 'C3_2023', type: 'radio', tags: ['深度用户']},
          {name: 'C3_2024', type: 'radio', tags: ['深度用户']},
          {name: 'C3_2025', type: 'radio', tags: ['深度用户']},
          {name: 'C4_2023', type: 'radio', tags: ['深度用户']},
          {name: 'C4_2024', type: 'radio', tags: ['深度用户']},
          {name: 'C4_2025', type: 'radio', tags: ['深度用户']},
          {name: 'C5', type: 'checkbox', tags: ['初级用户', '深度用户']},
          {name: 'C6', type: 'radio', tags: ['初级用户', '深度用户']},
          {name: 'C7', type: 'checkbox', tags: ['初级用户', '深度用户']},
          {name: 'CD1', type: 'checkbox', tags: ['深度用户']},
          {name: 'CD2', type: 'radio', tags: ['深度用户']},
          {name: 'CD3', type: 'checkbox', tags: ['深度用户']},
          {name: 'CD4', type: 'radio', tags: ['深度用户']},
          {name: 'CD5_simple', type: 'radio', tags: ['深度用户']},
          {name: 'CD5_medium', type: 'radio', tags: ['深度用户']},
          {name: 'CD5_complex', type: 'radio', tags: ['深度用户']},
          {name: 'CD7', type: 'checkbox', tags: ['深度用户', '决策者']},
          {name: 'CD8', type: 'radio', tags: ['深度用户', '决策者']},
          // AI态度（所有用户）
          {name: 'D1_2023年_1', type: 'radio'},
          {name: 'D1_2024年_1', type: 'radio'},
          {name: 'D1_2025年_1', type: 'radio'},
          {name: 'D1_2023年_2', type: 'radio'},
          {name: 'D1_2024年_2', type: 'radio'},
          {name: 'D1_2025年_2', type: 'radio'},
          {name: 'D1_2023年_3', type: 'radio'},
          {name: 'D1_2024年_3', type: 'radio'},
          {name: 'D1_2025年_3', type: 'radio'},
          {name: 'D1_2023年_4', type: 'radio'},
          {name: 'D1_2024年_4', type: 'radio'},
          {name: 'D1_2025年_4', type: 'radio'},
          {name: 'D1_2023年_5', type: 'radio'},
          {name: 'D1_2024年_5', type: 'radio'},
          {name: 'D1_2025年_5', type: 'radio'},
          {name: 'D1_2023年_6', type: 'radio'},
          {name: 'D1_2024年_6', type: 'radio'},
          {name: 'D1_2025年_6', type: 'radio'},
          {name: 'D1_2023年_7', type: 'radio'},
          {name: 'D1_2024年_7', type: 'radio'},
          {name: 'D1_2025年_7', type: 'radio'},
          {name: 'D1_2023年_8', type: 'radio'},
          {name: 'D1_2024年_8', type: 'radio'},
          {name: 'D1_2025年_8', type: 'radio'},
          {name: 'D1_2023年_9', type: 'radio'},
          {name: 'D1_2024年_9', type: 'radio'},
          {name: 'D1_2025年_9', type: 'radio'},
          {name: 'D1_2023年_10', type: 'radio'},
          {name: 'D1_2024年_10', type: 'radio'},
          {name: 'D1_2025年_10', type: 'radio'},
          {name: 'D2', type: 'radio'},
          {name: 'D3', type: 'checkbox'},
          {name: 'D4', type: 'checkbox'},
          // 展望与建议（所有用户）
          {name: 'E1', type: 'checkbox'},
          {name: 'E2', type: 'checkbox'},
          // 职业概况（所有用户）
          {name: 'B2', type: 'radio'},
          {name: 'B3', type: 'radio'},
          {name: 'B4', type: 'checkbox'},
          {name: 'B5', type: 'checkbox'}
        ];
        
        // 过滤出用户应该验证的题目
        const requiredQuestions = allRequiredQuestions.filter(q => {
          // 检查条件函数
          if (q.condition && !q.condition()) {
            return false;
          }
          // 检查标签要求
          if (q.tags) {
            return q.tags.some(tag => userTags.includes(tag));
          }
          // 没有标签要求的题目都需要验证
          return true;
        });
        
        console.log('用户应验证题目数量:', requiredQuestions.length);
        
        let firstInvalidField = null;
        
        // 验证所有必填项
        requiredQuestions.forEach(q => {
          let hasValue = false;
          let firstInput = null;
          let targetElement = null;
          
          if (q.type === 'checkbox-column') {
            // 验证C2矩阵的某一列（年份）
            const year = q.name.split('_')[1];
            const columnInputs = form.querySelectorAll(`input[name^="C2_"][name$="_${year}"]`);
            hasValue = Array.from(columnInputs).some(input => input.checked);
            firstInput = columnInputs[0];
            
            if (firstInput) {
              const table = firstInput.closest('table');
              const thead = table.querySelector('thead tr');
              const thCells = thead.querySelectorAll('th');
              let columnIndex = -1;
              
              // 找到对应年份的列索引
              thCells.forEach((th, index) => {
                if (th.textContent.includes(year)) {
                  columnIndex = index;
                }
              });
              
              if (columnIndex > 0) {
                targetElement = thCells[columnIndex];
              }
            }
          } else {
            const inputs = form.querySelectorAll(`input[name="${q.name}"]`);
            hasValue = Array.from(inputs).some(input => input.checked);
            firstInput = inputs[0];
            
            // 对于矩阵题，在对应的行下方显示错误
            if (firstInput && (q.name.includes('C1_') || q.name.includes('C3_') || q.name.includes('C4_') || q.name.includes('D1_') || q.name.includes('CD5_'))) {
              const row = firstInput.closest('tr');
              if (row) {
                const yearCell = row.querySelector('td:first-child');
                targetElement = yearCell;
              }
            } else if (firstInput) {
              // 向上查找包含label.font-bold的div
              let currentDiv = firstInput.closest('div');
              while (currentDiv && !currentDiv.querySelector('label.font-bold')) {
                currentDiv = currentDiv.parentElement.closest('div');
              }
              targetElement = currentDiv ? currentDiv.querySelector('label.font-bold') : null;
            }
          }
          
          if (!hasValue && targetElement) {
            const errorMsg = document.createElement('p');
            errorMsg.className = 'validation-error mt-2 text-sm text-red-600';
            errorMsg.textContent = '请至少选择一项！';
            
            if (targetElement.tagName === 'TD' || targetElement.tagName === 'TH') {
              // 对于表格单元格，在内部添加
              targetElement.appendChild(errorMsg);
            } else {
              // 对于普通元素，在后面添加
              targetElement.after(errorMsg);
            }
            
            if (!firstInvalidField) {
              firstInvalidField = firstInput ? firstInput.closest('div, tr') : null;
            }
          }
        });
        
        if (firstInvalidField) {
          // 如果有未填的必填项，需要显示对应的section并滚动到错误位置
          const invalidFieldName = firstInvalidField.querySelector('input')?.name;
          
          // 根据字段名判断属于哪个section并显示
          if (invalidFieldName && (invalidFieldName.startsWith('B2') || invalidFieldName.startsWith('B3') || invalidFieldName.startsWith('B4') || invalidFieldName.startsWith('B5'))) {
            // 职业概况section的字段，确保该section可见
            document.querySelectorAll('#blockC, #blockD, #blockE').forEach(el => {
              el.classList.add('hidden');
            });
            document.getElementById('blockG').classList.remove('hidden');
            document.getElementById('blockF').classList.remove('hidden');
            document.getElementById('submitSection').classList.remove('hidden');
          }
          
          firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
          return;
        }
        
        // 更新E4排序数据
        updateRankNumbers();
        
        // 收集表单数据
        const formData = new FormData(form);
        const data = {};
        
        // 清理键名函数 - 移除Firebase不允许的字符
        function cleanKey(key) {
          return key.replace(/[.#$\[\]/]/g, '_').replace(/\//g, '_');
        }
        
        for (let [key, value] of formData.entries()) {
          const cleanedKey = cleanKey(key);
          if (data[cleanedKey]) {
            if (Array.isArray(data[cleanedKey])) {
              data[cleanedKey].push(value);
            } else {
              data[cleanedKey] = [data[cleanedKey], value];
            }
          } else {
            data[cleanedKey] = value;
          }
        }
        
        data._timestamp = new Date().toISOString();
        data._version = "2025.1";
        
        // 保存到Firebase
        data.timestamp = firebase.database.ServerValue.TIMESTAMP;
        
        database.ref('surveys').push(data)
          .then(() => {
            // 隐藏填写说明
            document.querySelector('section.mb-6').style.display = 'none';
            
            submitSuccess.classList.remove('hidden');
            form.style.display = 'none';
            submitSuccess.scrollIntoView({ behavior: 'smooth' });
          })
          .catch((error) => {
            alert('提交失败，请稍后重试。');
          });
      });
      
      // 查看调查结果按钮事件
      document.getElementById('showReportBtn').addEventListener('click', function() {
        document.getElementById('surveyReport').classList.remove('hidden');
        document.getElementById('surveyReport').scrollIntoView({ behavior: 'smooth' });
        loadSurveyReport();
      });
      
      // 关闭报告按钮事件
      document.getElementById('closeReportBtn').addEventListener('click', function() {
        document.getElementById('surveyReport').classList.add('hidden');
        document.getElementById('submitSuccess').scrollIntoView({ behavior: 'smooth' });
      });
      
      // 加载调查结果报告
      function loadSurveyReport() {
        const reportContent = document.getElementById('reportContent');
        
        // 显示加载状态
        reportContent.innerHTML = `
          <div class="text-center py-8">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-600">正在加载调查数据...</p>
          </div>
        `;
        
        // 尝试从 Firebase 读取数据，失败时使用模拟数据
        database.ref('surveys').once('value')
          .then((snapshot) => {
            const data = snapshot.val();
            if (data) {
              const surveys = Object.values(data);
              generateReport(surveys);
            } else {
              generateReport(getMockData());
            }
          })
          .catch((error) => {
            // Firebase连接失败，使用模拟数据演示
            generateReport(getMockData());
          });
      }
      
      // 获取模拟数据用于演示
      function getMockData() {
        return [
          {S2: 'A', S5: 'D', B2: 'B', B3: 'B', B4: ['A', 'B'], 'D1_2025年_1': '同意', D2: 'C', D3: ['A', 'B']},
          {S2: 'B', S5: 'E', B2: 'C', B3: 'C', B4: ['B', 'C'], 'D1_2025年_1': '非常同意', D2: 'C', D3: ['B', 'E']},
          {S2: 'C', S5: 'C', B2: 'A', B3: 'A', B4: ['A'], 'D1_2025年_1': '中立', D2: 'D', D3: ['C', 'D']},
          {S2: 'A', S5: 'D', B2: 'D', B3: 'D', B4: ['A', 'D'], 'D1_2025年_1': '同意', D2: 'C', D3: ['A', 'G']},
          {S2: 'C', S5: 'B', B2: 'B', B3: 'B', B4: ['B', 'C', 'D'], 'D1_2025年_1': '不同意', D2: 'E', D3: ['E', 'F']}
        ];
      }
      
      // 生成报告
      function generateReport(surveys) {
        const reportContent = document.getElementById('reportContent');
        const totalCount = surveys.length;
        
        // 统计各个问题的结果
        const stats = {
          organizationType: {},
          workContent: {},
          aiUsageFrequency: {},
          aiTools: {},
          efficiency2025: {},
          jobLevel: {},
          experience: {},
          programmingLanguages: {},
          aiAttitude2025: {},
          futureImpact: {},
          constraints: {}
        };
        
        surveys.forEach(survey => {
          // 组织类型 (S2)
          if (survey.S2) {
            const orgMap = {
              'A': '跨国药企（MNC）',
              'B': '本土药企（Local）',
              'C': 'CRO/服务外包公司',
              'D': '其他医药相关机构',
              'E': '不方便透露'
            };
            const orgType = orgMap[survey.S2] || survey.S2;
            stats.organizationType[orgType] = (stats.organizationType[orgType] || 0) + 1;
          }
          
          // AI使用频率 (S5)
          if (survey.S5) {
            const freqMap = {
              'A': '从不',
              'B': '很少（每季度或更少）',
              'C': '偶尔（每月）',
              'D': '经常（每周）',
              'E': '频繁（几乎每天）'
            };
            const freq = freqMap[survey.S5] || survey.S5;
            stats.aiUsageFrequency[freq] = (stats.aiUsageFrequency[freq] || 0) + 1;
          }
          
          // 岗位级别 (B2)
          if (survey.B2) {
            const levelMap = {
              'A': '初级/助理',
              'B': '中级/资深',
              'C': '主管/组长',
              'D': '经理/负责人',
              'E': '总监及以上'
            };
            const level = levelMap[survey.B2] || survey.B2;
            stats.jobLevel[level] = (stats.jobLevel[level] || 0) + 1;
          }
          
          // 从业年限 (B3)
          if (survey.B3) {
            const expMap = {
              'A': '0-2年',
              'B': '3-5年',
              'C': '6-9年',
              'D': '10-14年',
              'E': '15年及以上'
            };
            const exp = expMap[survey.B3] || survey.B3;
            stats.experience[exp] = (stats.experience[exp] || 0) + 1;
          }
          
          // 编程语言 (B4)
          if (survey.B4) {
            const langMap = {
              'A': 'SAS',
              'B': 'R',
              'C': 'Python',
              'D': 'SQL',
              'E': 'Julia'
            };
            const languages = Array.isArray(survey.B4) ? survey.B4 : [survey.B4];
            languages.forEach(lang => {
              const langName = langMap[lang] || lang;
              stats.programmingLanguages[langName] = (stats.programmingLanguages[langName] || 0) + 1;
            });
          }
          
          // AI提升统计编程效率的态度 (D1_2025年_1)
          if (survey['D1_2025年_1']) {
            const attitudeMap = {
              '非常不同意': '非常不同意',
              '不同意': '不同意',
              '中立': '中立',
              '同意': '同意',
              '非常同意': '非常同意'
            };
            const attitude = attitudeMap[survey['D1_2025年_1']] || survey['D1_2025年_1'];
            stats.aiAttitude2025[attitude] = (stats.aiAttitude2025[attitude] || 0) + 1;
          }
          
          // 未来影响 (D2)
          if (survey.D2) {
            const impactMap = {
              'A': '增加对人工统计编程的要求',
              'B': '减少对人工统计编程的需求',
              'C': '进一步增强生产力，形成行业刚需',
              'D': '有助提升，但影响有限',
              'E': '与现有工具类似，不会显著改变行业',
              'F': '可能带来负面影响',
              'G': '不确定/难以预测'
            };
            const impact = impactMap[survey.D2] || survey.D2;
            stats.futureImpact[impact] = (stats.futureImpact[impact] || 0) + 1;
          }
          
          // 制约因素 (D3)
          if (survey.D3) {
            const constraintMap = {
              'A': '数据安全与隐私合规风险',
              'B': 'AI输出的准确性与可信度不足',
              'C': '缺乏针对性的AI工具与平台',
              'D': '公司政策限制或缺乏明确指导',
              'E': '团队技能与培训不足',
              'F': '成本考虑',
              'G': '审计追踪与可重现性要求',
              'H': '监管部门对AI使用的不确定态度'
            };
            const constraints = Array.isArray(survey.D3) ? survey.D3 : [survey.D3];
            constraints.forEach(constraint => {
              const constraintName = constraintMap[constraint] || constraint;
              stats.constraints[constraintName] = (stats.constraints[constraintName] || 0) + 1;
            });
          }
        });
        
        // 生成报告 HTML
        reportContent.innerHTML = `
          <div class="bg-blue-50 p-4 rounded-lg mb-6">
            <h4 class="font-bold text-blue-800 mb-2">📊 数据概览</h4>
            <p class="text-blue-700">总参与人数：<strong>${totalCount}</strong> 人</p>
            <p class="text-sm text-blue-600 mt-1">数据更新时间：${new Date().toLocaleString('zh-CN')}</p>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            ${generateChartSection('组织类型分布', stats.organizationType, totalCount, 'org-chart')}
            ${generateChartSection('AI使用频率分布', stats.aiUsageFrequency, totalCount, 'freq-chart')}
            ${generateChartSection('岗位级别分布', stats.jobLevel, totalCount, 'level-chart')}
            ${generateChartSection('从业年限分布', stats.experience, totalCount, 'exp-chart')}
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
            ${generateChartSection('编程语言使用情况', stats.programmingLanguages, totalCount, 'lang-chart')}
            ${generateChartSection('AI提升效率态度(2025)', stats.aiAttitude2025, totalCount, 'attitude-chart')}
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
            ${generateChartSection('未来3-5年AI影响预期', stats.futureImpact, totalCount, 'impact-chart')}
            ${generateChartSection('主要制约因素', stats.constraints, totalCount, 'constraint-chart')}
          </div>
          
          <div class="mt-6 text-center text-sm text-gray-500">
            <p>ℹ️ 此报告基于当前所有问卷数据生成，仅供参考</p>
          </div>
        `;
      }
      
      // 生成图表区域
      function generateChartSection(title, data, total, chartId, isFullWidth = false) {
        if (Object.keys(data).length === 0) {
          return `
            <div class="${isFullWidth ? 'col-span-full' : ''} bg-white p-4 rounded-lg border shadow-sm">
              <h4 class="font-bold text-gray-800 mb-4">${title}</h4>
              <p class="text-gray-500 text-center py-4">暂无数据</p>
            </div>
          `;
        }
        
        const sortedData = Object.entries(data).sort((a, b) => b[1] - a[1]);
        const maxValue = Math.max(...Object.values(data));
        
        // 为不同类型的图表选择不同的颜色
        const getBarColor = (index, chartType) => {
          const colors = {
            'org-chart': ['bg-blue-500', 'bg-blue-400', 'bg-blue-300', 'bg-blue-200', 'bg-blue-100'],
            'freq-chart': ['bg-green-500', 'bg-green-400', 'bg-green-300', 'bg-green-200', 'bg-green-100'],
            'level-chart': ['bg-purple-500', 'bg-purple-400', 'bg-purple-300', 'bg-purple-200', 'bg-purple-100'],
            'exp-chart': ['bg-orange-500', 'bg-orange-400', 'bg-orange-300', 'bg-orange-200', 'bg-orange-100'],
            'lang-chart': ['bg-red-500', 'bg-red-400', 'bg-red-300', 'bg-red-200', 'bg-red-100'],
            'attitude-chart': ['bg-emerald-500', 'bg-emerald-400', 'bg-emerald-300', 'bg-emerald-200', 'bg-emerald-100'],
            'impact-chart': ['bg-indigo-500', 'bg-indigo-400', 'bg-indigo-300', 'bg-indigo-200', 'bg-indigo-100'],
            'constraint-chart': ['bg-rose-500', 'bg-rose-400', 'bg-rose-300', 'bg-rose-200', 'bg-rose-100']
          };
          const colorSet = colors[chartId] || colors['org-chart'];
          return colorSet[index % colorSet.length] || 'bg-gray-400';
        };
        
        const chartHTML = sortedData.map(([label, count], index) => {
          const percentage = ((count / total) * 100).toFixed(1);
          const barWidth = maxValue > 0 ? (count / maxValue) * 100 : 0;
          const barColor = getBarColor(index, chartId);
          
          return `
            <div class="mb-3 animate-fadeIn" style="animation-delay: ${index * 0.1}s">
              <div class="flex justify-between items-center mb-1">
                <span class="text-sm font-medium text-gray-700 truncate" title="${label}">${label}</span>
                <span class="text-sm text-gray-600 ml-2 flex-shrink-0">${count}人 (${percentage}%)</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                <div class="${barColor} h-3 rounded-full chart-bar" style="width: ${barWidth}%; transition-delay: ${index * 0.1}s"></div>
              </div>
            </div>
          `;
        }).join('');
        
        return `
          <div class="${isFullWidth ? 'col-span-full' : ''} bg-white p-4 rounded-lg border shadow-sm hover:shadow-md transition-shadow">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center">
              <span class="w-3 h-3 ${getBarColor(0, chartId)} rounded-full mr-2"></span>
              ${title}
            </h4>
            <div id="${chartId}">
              ${chartHTML}
            </div>
            <div class="mt-3 pt-3 border-t border-gray-100">
              <p class="text-xs text-gray-500">有效样本数：${Object.values(data).reduce((a, b) => a + b, 0)} / ${total}</p>
            </div>
          </div>
        `;
      }

    });
  </script>
</body>
</html>
